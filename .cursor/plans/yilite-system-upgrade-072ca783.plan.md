<!-- 072ca783-d5ea-4cdd-9f70-0b24fd63c6bf a24f9862-2423-4c08-9cfb-26f9718638ec -->
# Yilite ç³»ç»Ÿå‡çº§æŠ€æœ¯æ–¹æ¡ˆ V10 (é‡ç»„ç‰ˆ)

## ğŸ“‹ ç›®å½•

- [éœ€æ±‚æ¸…å•](#éœ€æ±‚æ¸…å•ä¸è§£å†³æ–¹æ¡ˆæ˜ å°„)
- [æ‰§è¡Œè·¯çº¿å›¾](#æ‰§è¡Œè·¯çº¿å›¾)
- [é˜¶æ®µ0ï¼šAgentæ¶æ„ç²¾ç®€](#é˜¶æ®µ0agentæ¶æ„ç²¾ç®€å‰ç½®å‡†å¤‡)
- [é˜¶æ®µ1ï¼šç‰ˆæœ¬æ§åˆ¶ä¸è‰ç¨¿å‘å¸ƒ](#é˜¶æ®µ1ç‰ˆæœ¬æ§åˆ¶ä¸è‰ç¨¿å‘å¸ƒåŸºç¡€è®¾æ–½)
- [é˜¶æ®µ2ï¼šSTEPè½¬GLBç¼–ç ä¿®å¤](#é˜¶æ®µ2stepè½¬glbç¼–ç ä¿®å¤è´¨é‡ä¼˜åŒ–)
- [é˜¶æ®µ3ï¼šæ™ºèƒ½è¯†åˆ«ä¸å•æ¬¡ä¸Šä¼ ](#é˜¶æ®µ3æ™ºèƒ½è¯†åˆ«ä¸å•æ¬¡ä¸Šä¼ æ ¸å¿ƒæµç¨‹)
- [é˜¶æ®µ4ï¼šç§»åŠ¨ç«¯é€‚é…](#é˜¶æ®µ4ç§»åŠ¨ç«¯é€‚é…ç”¨æˆ·ä½“éªŒ)
- [é˜¶æ®µ5ï¼š3Dæ¨¡å‹åŠ¨æ€ç¼–è¾‘](#é˜¶æ®µ53dæ¨¡å‹åŠ¨æ€ç¼–è¾‘é«˜çº§åŠŸèƒ½)
- [è¾“å‡ºç›®å½•ç»“æ„](#è¾“å‡ºç›®å½•ç»“æ„)

---

## éœ€æ±‚æ¸…å•ä¸è§£å†³æ–¹æ¡ˆæ˜ å°„

| # | éœ€æ±‚ | è§£å†³æ–¹æ¡ˆ | æ‰€å±é˜¶æ®µ | ä¼˜å…ˆçº§ |
|---|------|---------|---------|--------|
| 6 | ç‰ˆæœ¬æ§åˆ¶ | Draft/Publishæœºåˆ¶(ä»…å‘å¸ƒæ—¶ç”Ÿæˆç‰ˆæœ¬) | é˜¶æ®µ1 | P0 |
| 8 | ä¿®æ”¹æè¿° | æ–°å¢æè¿°ç¼–è¾‘tabï¼Œä¿å­˜åˆ°draftï¼Œå‘å¸ƒæ—¶æ‰ç”Ÿæ•ˆ | é˜¶æ®µ1 | P0 |
| 5 | çœŸå®æ–‡ä»¶å | PDFæ–‡ä»¶å=task_id=é¡¹ç›®åï¼ŒåºŸå¼ƒ"ç»„ä»¶1" | é˜¶æ®µ3 | P0 |
| 9 | BOMåºå·é¡ºåº | ä¿®æ”¹Agent 3/4æç¤ºè¯ï¼Œå¼ºåˆ¶æŒ‰BOM seqæ’åº | é˜¶æ®µ3 | P0 |
| - | ä¸­æ–‡ä¹±ç  | STEPè½¬GLBç¼–ç æ£€æµ‹ä¸ä¿®å¤ | é˜¶æ®µ2 | P1 |
| 1 | æ‰‹æœºæŸ¥çœ‹ | å¢å¼ºç‰ˆå“åº”å¼ + æ»‘åŠ¨æ‰‹åŠ¿ + åº•éƒ¨å¤§æŒ‰é’® + è‡ªåŠ¨æ’­æ”¾ | é˜¶æ®µ4 | P1 |
| 3 | çˆ†ç‚¸è§†å›¾é€æ­¥æ˜¾ç¤º | æ§åˆ¶Mesh.visibleï¼Œæ¯æ­¥ç´¯åŠ æ˜¾ç¤ºé›¶ä»¶ | é˜¶æ®µ4 | P1 |
| 7 | è‡ªåŠ¨æ’­æ”¾ | setIntervalå®šæ—¶åˆ‡æ¢æ­¥éª¤ | é˜¶æ®µ4 | P1 |
| 2 | æ’å…¥æ–°æ¨¡å‹ | MVPåŠè‡ªåŠ¨ç»‘å®š: ä¸Šä¼ ->é€‰æ­¥éª¤->æ‰‹åŠ¨å¯¹é½->å†™å…¥è‰ç¨¿ | é˜¶æ®µ5 | P2 |
| 4 | è‡ªåŠ¨è½¬STEP | æš‚ç¼“ | - | - |

---

## æ‰§è¡Œè·¯çº¿å›¾

```mermaid
graph TD
    A[é˜¶æ®µ0: Agentæ¶æ„ç²¾ç®€<br/>ç†è§£æ–°æ¶æ„] --> B[é˜¶æ®µ1: ç‰ˆæœ¬æ§åˆ¶<br/>åŸºç¡€è®¾æ–½<br/>é¢„è®¡1å‘¨]
    B --> C[é˜¶æ®µ2: ç¼–ç ä¿®å¤<br/>è´¨é‡ä¼˜åŒ–<br/>é¢„è®¡3å¤©]
    C --> D[é˜¶æ®µ3: å•æ¬¡ä¸Šä¼ <br/>æ ¸å¿ƒæµç¨‹<br/>é¢„è®¡2å‘¨]
    D --> E[é˜¶æ®µ4: ç§»åŠ¨ç«¯<br/>ç”¨æˆ·ä½“éªŒ<br/>é¢„è®¡1å‘¨]
    D --> F[é˜¶æ®µ5: 3Dç¼–è¾‘<br/>é«˜çº§åŠŸèƒ½<br/>é¢„è®¡2å‘¨]

    style A fill:#e1f5ff
    style B fill:#fff3e0
    style C fill:#f3e5f5
    style D fill:#e8f5e9
    style E fill:#fce4ec
    style F fill:#fff9c4
```

**å…³é”®ä¾èµ–å…³ç³»ï¼š**
- é˜¶æ®µ1æ˜¯æ‰€æœ‰åç»­é˜¶æ®µçš„åŸºç¡€ï¼ˆæä¾›æ•°æ®å­˜å‚¨æœºåˆ¶ï¼‰
- é˜¶æ®µ2å¯ä¸é˜¶æ®µ3å¹¶è¡Œï¼Œä½†å»ºè®®å…ˆå®Œæˆï¼ˆé¿å…ç”Ÿæˆä¹±ç æ•°æ®ï¼‰
- é˜¶æ®µ3å®Œæˆåï¼Œé˜¶æ®µ4å’Œé˜¶æ®µ5å¯å¹¶è¡Œå¼€å‘
- æ€»é¢„è®¡æ—¶é—´ï¼š5-6å‘¨ï¼ˆä¸²è¡Œï¼‰ï¼Œ4å‘¨ï¼ˆéƒ¨åˆ†å¹¶è¡Œï¼‰

---

## é˜¶æ®µ0ï¼šAgentæ¶æ„ç²¾ç®€ï¼ˆå‰ç½®å‡†å¤‡ï¼‰

> **ç›®æ ‡**ï¼šç†è§£æ–°æ¶æ„ï¼Œä¸ºåç»­å¼€å‘åšå‡†å¤‡
> **ä¾èµ–**ï¼šæ— 
> **é¢„è®¡æ—¶é—´**ï¼š1å¤©ï¼ˆå­¦ä¹ ç†è§£ï¼‰
> **éªŒæ”¶æ ‡å‡†**ï¼šå›¢é˜Ÿæˆå‘˜ç†è§£æ–°æ¶æ„çš„æ•°æ®æµå’Œå„ç»„ä»¶èŒè´£

### 0.1 å½“å‰æ¶æ„ (6 Agents)

```
Agent1(è§†è§‰è§„åˆ’) -> Agent2(BOM-3D) -> Agent3(ç»„ä»¶è£…é…) -> Agent4(äº§å“æ€»è£…) -> Agent5(ç„Šæ¥) -> Agent6(å®‰å…¨)
```

**é—®é¢˜**ï¼š
- Agent1è°ƒç”¨AIæˆæœ¬é«˜ï¼Œä½†å®é™…åªæ˜¯æŒ‰BOMåºå·æ’åº
- Agent5åŠŸèƒ½å¯ä»¥åˆå¹¶åˆ°Agent3/4çš„æç¤ºè¯ä¸­
- ä¸­é—´æ–‡ä»¶è¿‡å¤šï¼Œç»´æŠ¤å¤æ‚

### 0.2 æ–°æ¶æ„ (SimplePlanner + 4 Agents)

```
SimplePlanner(æ›¿ä»£Agent1) -> Agent2(BOM-3D) -> Agent3æˆ–Agent4 -> Agent6(å®‰å…¨)
```

**å˜æ›´è¯´æ˜**:

- **Agent1 -> SimplePlanner**: ç”¨ä»£ç è‡ªåŠ¨ç”Ÿæˆplanning_resultï¼Œä¸å†è°ƒç”¨AI
  - åŸºå‡†ä»¶ = BOMåºå·ç¬¬ä¸€çš„é›¶ä»¶ï¼ˆseq=1ï¼‰
  - è£…é…é¡ºåº = ä¸¥æ ¼æŒ‰ç…§BOMåºå·ä»å°åˆ°å¤§
  - åŸºå‡†ç»„ä»¶ = BOMåºå·æœ€å°çš„ç»„ç„Šä»¶

- **ä¿ç•™ Agent2**: BOM-3DåŒ¹é…æ˜¯3Dé«˜äº®çš„æ ¸å¿ƒ

- **ä¿ç•™ Agent3**: ç»„ä»¶å†…éƒ¨é›¶ä»¶çš„ç„Šæ¥è£…é…æ­¥éª¤
  - åˆå¹¶Agent5ç„Šæ¥å·¥è‰ºåˆ°æç¤ºè¯åˆ°agent3

- **ä¿ç•™ Agent4**: äº§å“çº§ç»„ä»¶æ‹¼è£…æ­¥éª¤

- **ä¿ç•™ Agent6**: å®‰å…¨FAQæ•´åˆåˆ°assembly_manual.json

**ä¼˜åŠ¿**ï¼š
- é™ä½AIè°ƒç”¨æˆæœ¬
- ç®€åŒ–æ•°æ®æµ
- æé«˜å¯ç»´æŠ¤æ€§
- æ ¹æ®ç”¨æˆ·éœ€æ±‚ï¼Œéµå¾ªå®é™…å·¥ç¨‹åˆ¶å›¾æ ‡å‡†ï¼ˆBOMåºå·å³è£…é…é¡ºåºï¼‰

### 0.3 SimplePlannerå®ç°æ–¹æ¡ˆ

**é—®é¢˜**: åˆ é™¤Agent1åï¼Œåç»­æµç¨‹ä¾èµ–çš„å­—æ®µä¼šç¼ºå¤±:

- `component_assembly_plan` (ç»„ä»¶åˆ—è¡¨ã€åŸºå‡†ä»¶ã€è£…é…é¡ºåº)
- `product_assembly_plan` (äº§å“åã€åŸºå‡†ç»„ä»¶)

**è§£å†³**: æ–°å¢ `core/simple_planner.py`ï¼ˆåœ¨é˜¶æ®µ3å®ç°ï¼‰

```python
import json
from typing import Dict, List
from pathlib import Path
from datetime import datetime

class SimplePlanner:
    """
    ç®€åŒ–çš„è§„åˆ’ç”Ÿæˆå™¨ - æ›¿ä»£Agent1

    æ ¸å¿ƒåŸåˆ™ï¼ˆå·¥ç¨‹åˆ¶å›¾æ ‡å‡†ï¼‰ï¼š
    - åŸºå‡†ä»¶ = BOMåºå·ç¬¬ä¸€çš„é›¶ä»¶ï¼ˆseq=1ï¼‰
    - åŸºå‡†ç»„ä»¶ = BOMåºå·æœ€å°çš„ç»„ç„Šä»¶
    - è£…é…é¡ºåº = ä¸¥æ ¼æŒ‰ç…§BOMåºå·ä»å°åˆ°å¤§
    """
    
    def generate_component_plan(self, pdf_name: str, bom_data: list) -> dict:
        """
        ä¸ºç»„ä»¶å›¾ç”Ÿæˆè§„åˆ’ï¼ˆæ›¿ä»£Agent1å¯¹ç»„ä»¶çš„è§„åˆ’ï¼‰

        æ ¸å¿ƒè§„åˆ™ï¼ˆå·¥ç¨‹åˆ¶å›¾æ ‡å‡†ï¼‰ï¼š
        1. åŸºå‡†ä»¶ = BOMåºå·ç¬¬ä¸€çš„é›¶ä»¶ï¼ˆseq=1ï¼‰
        2. è£…é…é¡ºåº = BOMåºå·é¡ºåº

        Args:
            pdf_name: PDFæ–‡ä»¶åï¼ˆä½œä¸ºç»„ä»¶åï¼‰
            bom_data: BOMæ•°æ®åˆ—è¡¨

        Returns:
            å…¼å®¹Agent1è¾“å‡ºæ ¼å¼çš„planning_result
        """
        if not bom_data:
            raise ValueError(f"BOMæ•°æ®ä¸ºç©º: {pdf_name}")

        # âœ… æŒ‰seqæ’åºï¼ˆç¡®ä¿é¡ºåºæ­£ç¡®ï¼‰
        sorted_bom = sorted(bom_data, key=lambda x: int(x.get("seq", 999)))

        # âœ… åºå·1å°±æ˜¯åŸºå‡†ä»¶ï¼ˆå·¥ç¨‹æ ‡å‡†ï¼Œä¸æ˜¯æŒ‰é‡é‡ï¼‰
        base_part = sorted_bom[0]

        # éªŒè¯åŸºå‡†ä»¶ä¿¡æ¯å®Œæ•´æ€§
        if not base_part.get("code") or not base_part.get("name"):
            raise ValueError(f"åŸºå‡†ä»¶ä¿¡æ¯ä¸å®Œæ•´: {base_part}")

        return {
            "success": True,
            "component_assembly_plan": [{
                "component_code": pdf_name,
                "component_name": pdf_name,
                "assembly_order": 1,
                "drawing_number": "1",
                "base_part_code": base_part.get("code", ""),
                "base_part_name": base_part.get("name", ""),
                "base_part_seq": base_part.get("seq", "1"),  # âœ… è®°å½•BOMåºå·
                "base_part_material": base_part.get("material", ""),
                "base_part_quantity": base_part.get("quantity", 1),
                "assembly_steps": []  # Agent3ä¼šæŒ‰BOMåºå·ç”Ÿæˆæ­¥éª¤
            }],
            "product_assembly_plan": {},
            "metadata": {
                "total_parts": len(sorted_bom),
                "bom_sequence": [item.get("seq") for item in sorted_bom],
                "generated_by": "SimplePlanner",
                "generation_time": datetime.now().isoformat()
            }
        }
    
    def generate_product_plan(self, pdf_name: str, bom_data: list) -> dict:
        """
        ä¸ºäº§å“æ€»å›¾ç”Ÿæˆè§„åˆ’ï¼ˆæ›¿ä»£Agent1å¯¹äº§å“çš„è§„åˆ’ï¼‰

        æ ¸å¿ƒè§„åˆ™ï¼ˆå·¥ç¨‹åˆ¶å›¾æ ‡å‡†ï¼‰ï¼š
        1. åŸºå‡†ç»„ä»¶ = BOMåºå·æœ€å°çš„ç»„ç„Šä»¶
        2. è£…é…é¡ºåº = BOMåºå·é¡ºåº

        Args:
            pdf_name: PDFæ–‡ä»¶å
            bom_data: BOMæ•°æ®åˆ—è¡¨ï¼ˆåŒ…å«ç»„ç„Šä»¶ï¼‰

        Returns:
            å…¼å®¹Agent1è¾“å‡ºæ ¼å¼çš„planning_result
        """
        # æŒ‰seqæ’åº
        sorted_bom = sorted(bom_data, key=lambda x: int(x.get("seq", 999)))

        # æ‰¾å‡ºæ‰€æœ‰ç»„ç„Šä»¶
        sub_assemblies = [
            item for item in sorted_bom
            if self._is_sub_assembly(item)
        ]

        if not sub_assemblies:
            raise ValueError(f"äº§å“æ€»å›¾ä¸­æœªæ‰¾åˆ°ç»„ç„Šä»¶: {pdf_name}")

        # âœ… åºå·æœ€å°çš„ç»„ç„Šä»¶ä½œä¸ºåŸºå‡†ç»„ä»¶ï¼ˆå·¥ç¨‹æ ‡å‡†ï¼Œä¸æ˜¯æŒ‰é‡é‡ï¼‰
        base_component = sub_assemblies[0]

        # ç”Ÿæˆç»„ä»¶è£…é…è®¡åˆ’ï¼ˆæŒ‰BOMåºå·æ’åºï¼‰
        component_plans = []
        for i, comp in enumerate(sub_assemblies, 1):
            component_plans.append({
                "component_code": comp.get("code", ""),
                "component_name": comp.get("name", ""),
                "assembly_order": i,
                "drawing_number": str(i),
                "bom_seq": comp.get("seq", "")  # âœ… ä¿ç•™åŸå§‹BOMåºå·
            })

        return {
            "success": True,
            "component_assembly_plan": component_plans,
            "product_assembly_plan": {
                "product_name": pdf_name,
                "base_component_code": base_component.get("code", ""),
                "base_component_name": base_component.get("name", ""),
                "base_component_seq": base_component.get("seq", "1"),  # âœ… è®°å½•BOMåºå·
                "assembly_sequence": []  # Agent4ä¼šæŒ‰BOMåºå·ç”Ÿæˆæ­¥éª¤
            },
            "metadata": {
                "total_components": len(sub_assemblies),
                "total_parts": len(sorted_bom),
                "bom_sequence": [item.get("seq") for item in sorted_bom],
                "generated_by": "SimplePlanner",
                "generation_time": datetime.now().isoformat()
            }
        }

    def _is_sub_assembly(self, bom_item: dict) -> bool:
        """åˆ¤æ–­æ˜¯å¦ä¸ºç»„ç„Šä»¶"""
        material = bom_item.get("material", "").lower()
        name = bom_item.get("name", "").lower()

        # å…³é”®è¯åŒ¹é…
        keywords = ["ç»„ç„Šä»¶", "ç»„ä»¶", "assembly", "assy", "weldment"]
        return any(kw in material or kw in name for kw in keywords)
```

**è°ƒç”¨æ—¶æœº**: generate_singleæ¥å£ä¸­ï¼Œæ ¹æ®æ–‡ä»¶ç±»å‹è°ƒç”¨å¯¹åº”æ–¹æ³•ï¼ˆè¯¦è§é˜¶æ®µ3ï¼‰

### 0.4 ä¸­é—´æ–‡ä»¶å˜åŒ–

| æ—§æ–‡ä»¶å | æ–°æ¶æ„å¤„ç† |
|---------|-----------|
| step1_file_hierarchy.json | âŒ åˆ é™¤ |
| step2_bom_data.json | âœ… ä¿ç•™ä¸º `bom_data.json` |
| step3_planning_result.json | âœ… ä¿ç•™ä¸º `planning_result.json` (SimplePlannerç”Ÿæˆ) |
| step4_matching_result.json | âœ… ä¿ç•™ä¸º `matching_result.json` |
| step5/6_*.json | âœ… ä¿ç•™ä¸º `agent_output.json` |
| step7_enhanced_*.json | âŒ åˆ é™¤ |

### 0.5 æ–°æ¶æ„è¾“å‡ºç›®å½•ç»“æ„

```
output/{pdfæ–‡ä»¶å}/                    # task_id = PDFæ–‡ä»¶åï¼ˆå»åç¼€ï¼‰
â”œâ”€â”€ assembly_manual.json              # âœ… å·²å‘å¸ƒç‰ˆæœ¬ï¼ˆå·¥äººæŸ¥çœ‹ï¼‰
â”œâ”€â”€ draft.json                        # âœ… è‰ç¨¿ç‰ˆæœ¬ï¼ˆç¼–è¾‘å™¨ä½¿ç”¨ï¼‰
â”œâ”€â”€ versions/                         # âœ… ç‰ˆæœ¬å½’æ¡£ç›®å½•
â”‚   â”œâ”€â”€ v1.json                       #    ç‰ˆæœ¬1
â”‚   â”œâ”€â”€ v2.json                       #    ç‰ˆæœ¬2
â”‚   â””â”€â”€ version_history.json          #    ç‰ˆæœ¬å†å²å…ƒæ•°æ®
â”œâ”€â”€ planning_result.json              # ğŸ“‹ SimplePlannerç”Ÿæˆï¼ˆæ›¿ä»£Agent1ï¼‰
â”œâ”€â”€ bom_data.json                     #[object Object]å–ç»“æœ
â”œâ”€â”€ matching_result.[object Object]OM-3DåŒ¹é…ç»“æœ
â”œâ”€â”€ agent_output.json                 # ğŸ“‹ AgentåŸå§‹è¾“å‡º
â”œâ”€â”€ glb_files/                        # ğŸ¨ 3Dæ¨¡å‹æ–‡ä»¶
â”‚   â”œâ”€â”€ part_001.glb
â”‚   â”œâ”€â”€ part_002.glb
â”‚   â””â”€â”€ assembly.glb
â”œâ”€â”€ pdf_images/                       # ğŸ“„ PDFè½¬å›¾ç‰‡
â”‚   â”œâ”€â”€ page_1.png
â”‚   â””â”€â”€ page_2.png
â”œâ”€â”€ pdf_files/                        # ğŸ“„ åŸå§‹PDFæ–‡ä»¶
â”‚   â””â”€â”€ {task_id}.pdf
â”œâ”€â”€ step_files/                       # ğŸ“„ åŸå§‹STEPæ–‡ä»¶
â”‚   â””â”€â”€ {task_id}.step
â””â”€â”€ assets/                           # ğŸ¨ å¤–éƒ¨ä¸Šä¼ çš„æ¨¡å‹ï¼ˆé˜¶æ®µ5ï¼‰
    â”œâ”€â”€ extra_model_1.glb
    â””â”€â”€ extra_model_2.glb
```

**æ–‡ä»¶è¯´æ˜**ï¼š

| æ–‡ä»¶ | ç”¨é€” | ç”Ÿæˆæ—¶æœº | ä½¿ç”¨è€… |
|------|------|---------|--------|
| `assembly_manual.json` | å·²å‘å¸ƒçš„è£…é…æ‰‹å†Œ | ç‚¹å‡»[å‘å¸ƒ]æŒ‰é’® | å·¥äººï¼ˆManualViewerï¼‰ |
| `draft.json` | è‰ç¨¿ç‰ˆæœ¬ | ç‚¹å‡»[ä¿å­˜è‰ç¨¿]æŒ‰é’® | ç®¡ç†å‘˜ï¼ˆManualEditorï¼‰ |
| `versions/v*.json` | å†å²ç‰ˆæœ¬å½’æ¡£ | æ¯æ¬¡å‘å¸ƒè‡ªåŠ¨ç”Ÿæˆ | ç‰ˆæœ¬å›æº¯ |
| `planning_result.json` | è£…é…è§„åˆ’ | SimplePlannerè‡ªåŠ¨ç”Ÿæˆ | Agent2/3/4è¾“å…¥ |
| `bom_data.json` | BOMæ•°æ® | PDFè§£ææ—¶ç”Ÿæˆ | SimplePlannerè¾“å…¥ |
| `matching_result.json` | BOM-3DåŒ¹é… | Agent2ç”Ÿæˆ | Agent3/4è¾“å…¥ |
| `agent_output.json` | AgentåŸå§‹è¾“å‡º | Agent3/4/6ç”Ÿæˆ | è°ƒè¯•å’Œå®¡è®¡ |
| `glb_files/` | 3Dæ¨¡å‹ | STEPè½¬æ¢æ—¶ç”Ÿæˆ | å‰ç«¯3DæŸ¥çœ‹å™¨ |
| `assets/` | å¤–éƒ¨æ¨¡å‹ | ç”¨æˆ·ä¸Šä¼  | å‰ç«¯3DæŸ¥çœ‹å™¨ |

**æ•°æ®æµå‘**ï¼š

```
PDF + STEP
    â†“
[BOMæå–] â†’ bom_data.json
    â†“
[SimplePlanner] â†’ planning_result.json
    â†“
[Agent2] â†’ matching_result.json
    â†“
[Agent3/4] â†’ agent_output.json
    â†“
[æ•´åˆ] â†’ draft.json
    â†“
[å‘å¸ƒ] â†’ assembly_manual.json + versions/v{n}.json
```

---

## é˜¶æ®µ1ï¼šç‰ˆæœ¬æ§åˆ¶ä¸è‰ç¨¿å‘å¸ƒï¼ˆåŸºç¡€è®¾æ–½ï¼‰

## ğŸ¨ æ–¹æ¡ˆè¯¦ç»†æè¿°

### ä¸€ã€ManualViewer.vueï¼ˆå½“å‰é¡µé¢ï¼Œå°å¹…è°ƒæ•´ï¼‰

#### **1. ç®¡ç†å‘˜æŒ‰é’®åŒºåŸŸï¼ˆæ”¹åŠ¨ï¼‰**

**ç°åœ¨çš„æ ·å­ï¼š**
```
[ç®¡ç†å‘˜æ¨¡å¼æ ‡ç­¾] [ç¼–è¾‘å†…å®¹] [é€€å‡º]
```

**æ”¹ä¸ºï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [âœ… ç®¡ç†å‘˜æ¨¡å¼] [âœï¸ ç¼–è¾‘å†…å®¹] [ğŸš€ å‘å¸ƒæ–°ç‰ˆæœ¬]       â”‚
â”‚ [ğŸ“œ å†å²ç‰ˆæœ¬] [é€€å‡º]                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **2. ç¼–è¾‘ Dialogï¼ˆä¿å­˜æŒ‰é’®æ”¹åï¼‰**

**ç°åœ¨çš„æŒ‰é’®ï¼š**
```html
<el-button type="primary" @click="saveManualData">ä¿å­˜</el-button>
```

**æ”¹ä¸ºï¼š**
```html
<el-button type="primary" @click="saveDraft">ğŸ’¾ ä¿å­˜è‰ç¨¿</el-button>
```

#### **3. æ–°å¢å‘å¸ƒ Dialog**

ç‚¹å‡»"å‘å¸ƒæ–°ç‰ˆæœ¬"æŒ‰é’®åå¼¹å‡ºï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ğŸš€ å‘å¸ƒæ–°ç‰ˆæœ¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                              â”‚
â”‚  å½“å‰ç‰ˆæœ¬ï¼šv2                                â”‚
â”‚  å³å°†å‘å¸ƒï¼šv3                                â”‚
â”‚                                              â”‚
â”‚  ğŸ“ ç‰ˆæœ¬è¯´æ˜ï¼ˆå¿…å¡«ï¼‰ï¼š                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ä¿®æ”¹äº†æ­¥éª¤5çš„ç„Šæ¥è¦æ±‚                â”‚  â”‚
â”‚  â”‚ æ›´æ–°äº†æ­¥éª¤10çš„å®‰å…¨è­¦å‘Š               â”‚  â”‚
â”‚  â”‚                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                              â”‚
â”‚  å˜æ›´é¢„è§ˆï¼š                                  â”‚
â”‚  - ä¿®æ”¹äº† 2 ä¸ªæ­¥éª¤                           â”‚
â”‚  - æ–°å¢äº† 1 æ¡FAQ                            â”‚
â”‚                                              â”‚
â”‚           [å–æ¶ˆ]     [ç¡®è®¤å‘å¸ƒâœ…]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### äºŒã€VersionHistory.vueï¼ˆæ–°é¡µé¢ï¼Œç®¡ç†å‘˜ä¸“å±ï¼‰

#### **é¡µé¢å…¥å£**
- ç®¡ç†å‘˜åœ¨ ManualViewer.vue ç‚¹å‡»"å†å²ç‰ˆæœ¬"æŒ‰é’®
- è·³è½¬åˆ° `/version-history/:taskId`

#### **é¡µé¢å¸ƒå±€**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“œ è£…é…æ‰‹å†Œå†å²ç‰ˆæœ¬ - æŸäº§å“åç§°                       â”‚
â”‚  [â† è¿”å›å½“å‰ç‰ˆæœ¬]                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç‰ˆæœ¬æ—¶é—´çº¿                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  ğŸŸ¢ v3ï¼ˆå½“å‰å·²å‘å¸ƒï¼‰â­                                  â”‚
â”‚  ğŸ“… 2025-01-20 14:30                                    â”‚
â”‚  ğŸ“ ä¿®æ”¹äº†æ­¥éª¤5çš„ç„Šæ¥è¦æ±‚ï¼Œæ›´æ–°äº†æ­¥éª¤10çš„å®‰å…¨è­¦å‘Š       â”‚
â”‚  [ğŸ‘ï¸ é¢„è§ˆ] [âª å›æ»šåˆ°æ­¤ç‰ˆæœ¬]                           â”‚
â”‚                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                          â”‚
â”‚  âšª v2                                                   â”‚
â”‚  ğŸ“… 2025-01-15 09:15                                    â”‚
â”‚  ğŸ“ å¢åŠ äº†æ­¥éª¤20çš„è´¨é‡æ£€æŸ¥é¡¹                            â”‚
â”‚  [ğŸ‘ï¸ é¢„è§ˆ] [âª å›æ»šåˆ°æ­¤ç‰ˆæœ¬]                           â”‚
â”‚                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                          â”‚
â”‚  âšª v1ï¼ˆåˆå§‹ç‰ˆæœ¬ï¼‰                                      â”‚
â”‚  ğŸ“… 2025-01-10 10:00                                    â”‚
â”‚  ğŸ“ é¦–æ¬¡å‘å¸ƒè£…é…æ‰‹å†Œ                                     â”‚
â”‚  [ğŸ‘ï¸ é¢„è§ˆ]                                              â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **é¢„è§ˆåŠŸèƒ½**
ç‚¹å‡»"é¢„è§ˆ"æŒ‰é’®åï¼š
- åœ¨æ–°çª—å£/å¯¹è¯æ¡†ä¸­ä»¥**åªè¯»æ¨¡å¼**æ˜¾ç¤ºè¯¥ç‰ˆæœ¬çš„è£…é…æ‰‹å†Œ
- ç•Œé¢ä¸ ManualViewer.vue ç›¸åŒï¼Œä½†æ— ç¼–è¾‘åŠŸèƒ½
- å¯ä»¥æŸ¥çœ‹3Dæ¨¡å‹ã€å›¾çº¸ã€æ­¥éª¤è¯¦æƒ…

#### **å›æ»šåŠŸèƒ½**
ç‚¹å‡»"å›æ»šåˆ°æ­¤ç‰ˆæœ¬"æŒ‰é’®åï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ âš ï¸ ç¡®è®¤å›æ»š â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                          â”‚
â”‚  ç¡®å®šè¦å›æ»šåˆ°ç‰ˆæœ¬ v2 å—ï¼Ÿ                â”‚
â”‚                                          â”‚
â”‚  æ³¨æ„ï¼š                                  â”‚
â”‚  - å½“å‰è‰ç¨¿çš„ä¿®æ”¹å°†è¢«ä¸¢å¼ƒ                â”‚
â”‚  - å›æ»šåä¼šåˆ›å»ºæ–°ç‰ˆæœ¬ v4                 â”‚
â”‚  - åŸç‰ˆæœ¬ v3 ä¼šä¿ç•™åœ¨å†å²è®°å½•ä¸­          â”‚
â”‚                                          â”‚
â”‚        [å–æ¶ˆ]     [ç¡®è®¤å›æ»š]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ä¸‰ã€å®Œæ•´æ“ä½œæµç¨‹æ¼”ç¤º

#### **åœºæ™¯1ï¼šç¼–è¾‘ â†’ è‰ç¨¿ â†’ å‘å¸ƒ**

```
[ç®¡ç†å‘˜ç™»å½•]
    â†“
[ç‚¹å‡»"ç¼–è¾‘å†…å®¹"]
    â†“
[ä¿®æ”¹æ­¥éª¤5çš„ç„Šæ¥è¦æ±‚]
    â†“
[ç‚¹å‡»"ä¿å­˜è‰ç¨¿ğŸ’¾"]
    â†“
âœ… è‰ç¨¿å·²ä¿å­˜åˆ° draft.json
    â†“
[ç»§ç»­ä¿®æ”¹æ­¥éª¤10ã€æ­¥éª¤15...]
    â†“
[å¤šæ¬¡ç‚¹å‡»"ä¿å­˜è‰ç¨¿"]
    â†“
æ‰€æœ‰ä¿®æ”¹éƒ½åœ¨ draft.json ä¸­ï¼Œä¸å½±å“å·¥äººçœ‹åˆ°çš„ç‰ˆæœ¬
    â†“
[ç®¡ç†å‘˜æ»¡æ„åï¼Œç‚¹å‡»"å‘å¸ƒæ–°ç‰ˆæœ¬ğŸš€"]
    â†“
å¼¹å‡ºå‘å¸ƒå¯¹è¯æ¡†
    â†“
[å¡«å†™ç‰ˆæœ¬è¯´æ˜ï¼š"ä¿®æ”¹äº†5ä¸ªæ­¥éª¤çš„ç„Šæ¥è¦æ±‚"]
    â†“
[ç‚¹å‡»"ç¡®è®¤å‘å¸ƒâœ…"]
    â†“
åç«¯æ‰§è¡Œï¼š
- æ—§çš„ assembly_manual.json â†’ versions/v2.json
- draft.json â†’ assembly_manual.jsonï¼ˆv3ï¼‰
- æ›´æ–° version_history.json
- åˆ é™¤ draft.json
    â†“
âœ… ç‰ˆæœ¬ v3 å‘å¸ƒæˆåŠŸï¼
    â†“
å·¥äººåˆ·æ–°é¡µé¢åçœ‹åˆ°æœ€æ–°çš„ v3 ç‰ˆæœ¬
```

---

#### **åœºæ™¯2ï¼šæŸ¥çœ‹å†å²ç‰ˆæœ¬ â†’ å›æ»š**

```
[ç®¡ç†å‘˜ç‚¹å‡»"å†å²ç‰ˆæœ¬ğŸ“œ"]
    â†“
[è·³è½¬åˆ° VersionHistory.vue]
    â†“
[çœ‹åˆ°ç‰ˆæœ¬åˆ—è¡¨ï¼šv3, v2, v1]
    â†“
[ç‚¹å‡» v2 çš„"é¢„è§ˆğŸ‘ï¸"]
    â†“
[æ–°çª—å£æ˜¾ç¤º v2 çš„å†…å®¹ï¼ˆåªè¯»ï¼‰]
    â†“
[å‘ç° v2 æ¯” v3 æ›´å¥½]
    â†“
[ç‚¹å‡» v2 çš„"å›æ»šâª"]
    â†“
å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†
    â†“
[ç¡®è®¤å›æ»š]
    â†“
åç«¯æ‰§è¡Œï¼š
- versions/v2.json â†’ assembly_manual.jsonï¼ˆv4ï¼‰
- æ›´æ–° version_history.json
    â†“
âœ… å·²å›æ»šåˆ° v2ï¼Œå¹¶å‘å¸ƒä¸ºæ–°ç‰ˆæœ¬ v4
```

---

### å››ã€æ•°æ®å­˜å‚¨æ¶æ„

```
output/æŸäº§å“/
â”œâ”€â”€ assembly_manual.json         # å·²å‘å¸ƒçš„æœ€æ–°ç‰ˆæœ¬ï¼ˆv3ï¼‰
â”œâ”€â”€ draft.json                   # è‰ç¨¿ï¼ˆé¦–æ¬¡ç¼–è¾‘æ—¶åˆ›å»ºï¼‰
â”œâ”€â”€ versions/                    # å†å²ç‰ˆæœ¬å½’æ¡£
â”‚   â”œâ”€â”€ v1.json                  
â”‚   â”œâ”€â”€ v2.json                  
â”‚   â”œâ”€â”€ v3.json                  
â”‚   â””â”€â”€ version_history.json     # ç‰ˆæœ¬å…ƒæ•°æ®
â””â”€â”€ ...å…¶ä»–æ–‡ä»¶
```

**version_history.json å†…å®¹ï¼š**
```json
{
  "current_version": "v3",
  "versions": [
    {
      "version": "v3",
      "published_at": "2025-01-20T14:30:00",
      "changelog": "ä¿®æ”¹äº†æ­¥éª¤5çš„ç„Šæ¥è¦æ±‚ï¼Œæ›´æ–°äº†æ­¥éª¤10çš„å®‰å…¨è­¦å‘Š"
    },
    {
      "version": "v2",
      "published_at": "2025-01-15T09:15:00",
      "changelog": "å¢åŠ äº†æ­¥éª¤20çš„è´¨é‡æ£€æŸ¥é¡¹"
    },
    {
      "version": "v1",
      "published_at": "2025-01-10T10:00:00",
      "changelog": "é¦–æ¬¡å‘å¸ƒè£…é…æ‰‹å†Œ"
    }
  ]
}
```

---

### äº”ã€åç«¯ API è®¾è®¡

```python
# ç°æœ‰æ¥å£ï¼ˆéœ€è¦æ”¹åŠ¨ï¼‰
POST /api/manual/{task_id}/save          # æ”¹ä¸ºï¼šä¿å­˜è‰ç¨¿
GET  /api/manual/{task_id}               # è·å–æœ€æ–°å‘å¸ƒç‰ˆæœ¬ï¼ˆä¸å˜ï¼‰

# æ–°å¢æ¥å£
POST /api/manual/{task_id}/save-draft    # ä¿å­˜è‰ç¨¿ï¼ˆæ›¿ä»£åŸsaveï¼‰
POST /api/manual/{task_id}/publish       # å‘å¸ƒæ–°ç‰ˆæœ¬
GET  /api/manual/{task_id}/history       # è·å–ç‰ˆæœ¬å†å²åˆ—è¡¨
GET  /api/manual/{task_id}/version/{v}   # è·å–æŒ‡å®šç‰ˆæœ¬
POST /api/manual/{task_id}/rollback/{v}  # å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
```

---

### å…­ã€å…³é”®é—®é¢˜è§£å†³

#### **Q1ï¼šå¦‚ä½•é¿å…"å¢åˆ æ¨¡å‹éœ€è¦é‡æ–°ä¸Šä¼ "çš„é—®é¢˜ï¼Ÿ**
âœ… **é˜¶æ®µ1æ–¹æ¡ˆ**ï¼š
- ç¼–è¾‘æ—¶å¯ä»¥åˆ é™¤é›¶ä»¶ï¼ˆä» parts æ•°ç»„ç§»é™¤ï¼‰
- **é˜¶æ®µ5æ‰©å±•**ï¼šå¯ä»¥ä¸Šä¼ å¤–éƒ¨æ¨¡å‹åˆ° assets/ ç›®å½•

#### **Q2ï¼šå¤šæ¬¡ä¿®æ”¹å¦‚ä½•ä¸å½±å“å·²å‘å¸ƒç‰ˆæœ¬ï¼Ÿ**
âœ… æ‰€æœ‰ä¿®æ”¹éƒ½ä¿å­˜åˆ° draft.jsonï¼Œç‚¹å‡»"å‘å¸ƒ"æ‰æ›´æ–° assembly_manual.json

#### **Q3ï¼šå†å²ç‰ˆæœ¬å¦‚ä½•ç®¡ç†ï¼Ÿ**
âœ… æ¯æ¬¡å‘å¸ƒè‡ªåŠ¨å½’æ¡£åˆ° versions/ï¼ŒVersionHistory.vue å¯æŸ¥çœ‹å’Œå›æ»š

---

## ğŸ“ æ€»ç»“

1. âœ… **æœ€å°åŒ–æ”¹åŠ¨**ï¼šManualViewer.vue åªéœ€æ”¹æŒ‰é’®å’Œä¿å­˜é€»è¾‘
2. âœ… **è‰ç¨¿æœºåˆ¶**ï¼šå¤šæ¬¡ä¿å­˜â†’æœ€åå‘å¸ƒï¼Œä¸å½±å“å·¥äºº
3. âœ… **å†å²ç‰ˆæœ¬ç®¡ç†**ï¼šä¸“é—¨çš„é¡µé¢æŸ¥çœ‹å’Œå›æ»š
4. âœ… **é¿å…é‡æ–°ä¸Šä¼ **ï¼šæ‰€æœ‰ä¿®æ”¹åœ¨JSONå±‚é¢ï¼Œä¸éœ€è¦é‡æ–°ç”Ÿæˆ
5. âœ… **æƒé™æ§åˆ¶**ï¼šåªæœ‰ç®¡ç†å‘˜èƒ½ç¼–è¾‘å’ŒæŸ¥çœ‹å†å²ç‰ˆæœ¬

---

---

## é˜¶æ®µ2ï¼šSTEPè½¬GLBç¼–ç ä¿®å¤ï¼ˆè´¨é‡ä¼˜åŒ–ï¼‰

> **ç›®æ ‡**ï¼šè§£å†³STEPæ–‡ä»¶è½¬GLBæ—¶ä¸­æ–‡åç§°ä¹±ç é—®é¢˜
> **ä¾èµ–**ï¼šæ— ï¼ˆç‹¬ç«‹æŠ€æœ¯ä¼˜åŒ–ï¼‰
> **é¢„è®¡æ—¶é—´**ï¼š3å¤©
> **éªŒæ”¶æ ‡å‡†**ï¼š
> - âœ… è‡ªåŠ¨æ£€æµ‹STEPæ–‡ä»¶ç¼–ç 
> - âœ… æ­£ç¡®è½¬æ¢ä¸­æ–‡åç§°
> - âœ… GLBæ–‡ä»¶ä¸­ä¸­æ–‡æ˜¾ç¤ºæ­£å¸¸
> - âœ… æœ‰é™çº§å¤„ç†æœºåˆ¶

### 2.1 æ ¸å¿ƒè§„åˆ™

- ä¸€æ¬¡ä¸Šä¼ : 1ä¸ªPDF + 1ä¸ªSTEP
- task_id = PDFæ–‡ä»¶å(å»åç¼€)

### 2.2 æ–‡ä»¶ç±»å‹åˆ¤æ–­

```python
def identify_file_type(pdf_path, bom_data):
    if "ç»„ä»¶" in filename: return "component"
    if any("ç»„ç„Šä»¶" in x.get("material","") for x in bom_data): return "product"
    return "component"
```

### 2.3 ç”Ÿæˆæµç¨‹

```
upload_single -> æå–BOM -> identify_file_type -> è¿”å›è¯†åˆ«ç»“æœ
generate_single -> SimplePlannerç”Ÿæˆplanning -> Agent2/3æˆ–4 -> Agent6 -> æ•´åˆ
```

### 2.4 Agentæç¤ºè¯ä¿®æ”¹ (éœ€æ±‚9)

ä¿®æ”¹Agent3/4æç¤ºè¯ï¼Œå¼ºåˆ¶æŒ‰BOMåºå·æ’åº
ä¿®æ”¹agent3çš„æç¤ºè¯ï¼Œæ˜ç¡®ç»„ä»¶å›¾éƒ½æ˜¯æ•°æ®ç„Šæ¥æ­¥éª¤ï¼Œæ¯ä¸ªé›¶ä»¶ä¹‹é—´éƒ½æ˜¯ç„Šæ¥ã€‚
ä¿®æ”¹agent4çš„æç¤ºè¯ï¼Œæ˜ç¡®äº§å“æ€»å›¾ä¹‹é—´çš„é›¶ä»¶éƒ½æ˜¯æ‹¼è£…æ­¥éª¤ï¼Œæ¯ä¸ªç»„ä»¶é›¶ä»¶ä¹‹é—´éƒ½æ˜¯é›¶ä»¶è¿æ¥èµ·æ¥çš„ï¼Œè€Œä¸æ˜¯ç„Šæ¥ã€‚

---


## é˜¶æ®µ3ï¼šæ™ºèƒ½è¯†åˆ«ä¸å•æ¬¡ä¸Šä¼ ï¼ˆæ ¸å¿ƒæµç¨‹ï¼‰

> **ç›®æ ‡**ï¼šå®ç°å•æ–‡ä»¶å…¥å£çš„æ™ºèƒ½æµç¨‹ï¼Œæ›¿ä»£ç¹ççš„å¤šæ­¥éª¤ä¸Šä¼ 
> **ä¾èµ–**ï¼šé˜¶æ®µ1ã€é˜¶æ®µ2
> **é¢„è®¡æ—¶é—´**ï¼š2å‘¨
> **éªŒæ”¶æ ‡å‡†**ï¼š
> - âœ… å•ä¸€ä¸Šä¼ å…¥å£ï¼Œè‡ªåŠ¨è¯†åˆ«æ–‡ä»¶ç±»å‹
> - âœ… å¼ºåˆ¶æŒ‰BOMåºå·æ’åº
> - âœ… å®Œæ•´ç”Ÿæˆæµç¨‹è·‘é€š

### 3.1 æ ¸å¿ƒè§„åˆ™

- ä¸€æ¬¡ä¸Šä¼ : 1ä¸ªPDF + 1ä¸ªSTEP
- task_id = PDFæ–‡ä»¶å(å»åç¼€)

### 3.2 æ–‡ä»¶ç±»å‹åˆ¤æ–­

```python
def identify_file_type(pdf_path, bom_data):
    if "ç»„ä»¶" in filename: return "component"
    if any("ç»„ç„Šä»¶" in x.get("material","") for x in bom_data): return "product"
    return "component"
```
### 3.3 æ–‡ä»¶å‘½åè§„èŒƒï¼ˆæ ¸å¿ƒçº¦å®šï¼‰

- **task_id** = PDF æ–‡ä»¶åï¼ˆå»æ‰ `.pdf` åç¼€ï¼‰
- **STEP æ–‡ä»¶å** å¿…é¡»ä¸ PDF æ–‡ä»¶åå®Œå…¨ä¸€è‡´ï¼ˆä»…æ‰©å±•åä¸åŒï¼‰
- **é¡¹ç›®åç§°** = task_id

**ç¤ºä¾‹ï¼š**

- ä¸Šä¼ æ–‡ä»¶ï¼š
  - è£…é…å›¾.pdf
  - è£…é…å›¾.step
- ç”Ÿæˆç›®å½•ï¼š
  ```
  output/è£…é…å›¾/
  â”œâ”€â”€ assembly_manual.json
  â”œâ”€â”€ draft.json
  â”œâ”€â”€ pdf_files/è£…é…å›¾.pdf
  â”œâ”€â”€ step_files/è£…é…å›¾.step
  â””â”€â”€ ...
  ```

**å®ç°çº¦æŸï¼š**
- ä¸Šä¼ æ—¶è‡ªåŠ¨å–å¾— PDF æ–‡ä»¶åä½œä¸º task_id
- æ ¡éªŒ STEP æ–‡ä»¶åä¸ PDF æ–‡ä»¶åä¸€è‡´ï¼ˆæˆ–è‡ªåŠ¨é‡å‘½åï¼‰
- æ‰€æœ‰ API è°ƒç”¨ä½¿ç”¨ task_id ä½œä¸ºè·¯å¾„å‚æ•°

### 3.4 ç”Ÿæˆæµç¨‹
upload_single -> æå–BOM -> identify_file_type -> è¿”å›è¯†åˆ«ç»“æœ
generate_single -> SimplePlannerç”Ÿæˆplanning -> Agent2/3æˆ–4 -> Agent6 -> æ•´åˆ

### 3.5 Agentæç¤ºè¯ä¿®æ”¹ (éœ€æ±‚9)
ä¿®æ”¹Agent3/4æç¤ºè¯ï¼Œå¼ºåˆ¶æŒ‰BOMåºå·æ’åº ä¿®æ”¹agent3çš„æç¤ºè¯ï¼Œæ˜ç¡®ç»„ä»¶å›¾éƒ½æ˜¯æ•°æ®ç„Šæ¥æ­¥éª¤ï¼Œæ¯ä¸ªé›¶ä»¶ä¹‹é—´éƒ½æ˜¯ç„Šæ¥ã€‚ ä¿®æ”¹agent4çš„æç¤ºè¯ï¼Œæ˜ç¡®äº§å“æ€»å›¾ä¹‹é—´çš„é›¶ä»¶éƒ½æ˜¯æ‹¼è£…æ­¥éª¤ï¼Œæ¯ä¸ªç»„ä»¶é›¶ä»¶ä¹‹é—´éƒ½æ˜¯é›¶ä»¶è¿æ¥èµ·æ¥çš„ï¼Œè€Œä¸æ˜¯ç„Šæ¥ã€‚


## é˜¶æ®µ4ï¼šç§»åŠ¨ç«¯é€‚é…ï¼ˆç”¨æˆ·ä½“éªŒï¼‰

> **ç›®æ ‡**ï¼šä¼˜åŒ–ç§»åŠ¨ç«¯æµè§ˆä½“éªŒ
> **ä¾èµ–**ï¼šé˜¶æ®µ3
> **é¢„è®¡æ—¶é—´**ï¼š1å‘¨

### 4.1 å¢å¼ºç‰ˆå“åº”å¼å¸ƒå±€

- æ£€æµ‹isMobile (window.innerWidth < 768)
- æ‰‹æœºç«¯éšè—å·¦ä¾§å›¾çº¸æ ï¼Œ3D+æè¿°å…¨å±æ˜¾ç¤º
- åº•éƒ¨è¶…å¤§æŒ‰é’®å¯¼èˆªï¼ˆä¸Šä¸€æ­¥/ä¸‹ä¸€æ­¥ï¼‰

### 4.2 æ»‘åŠ¨æ‰‹åŠ¿åˆ‡æ¢

- ä½¿ç”¨åŸç”Ÿtouchäº‹ä»¶æˆ–hammer.jsåº“
- å·¦æ»‘ -> ä¸‹ä¸€æ­¥
- å³æ»‘ -> ä¸Šä¸€æ­¥

### 4.3 è‡ªåŠ¨æ’­æ”¾

- setIntervalå®šæ—¶åˆ‡æ¢æ­¥éª¤
- å¯é…ç½®æ’­æ”¾é—´éš”ï¼ˆé»˜è®¤5ç§’ï¼‰
- æ’­æ”¾/æš‚åœæŒ‰é’®

### 4.4 é€æ­¥æ˜¾ç¤º (éœ€æ±‚3)

- æ§åˆ¶Mesh.visible
- æ¯æ­¥åªæ˜¾ç¤ºå½“å‰æ­¥éª¤æ¶‰åŠçš„é›¶ä»¶
- é¢œè‰²ä»ä¸‰è‰²å˜æˆäºŒè‰²ï¼ˆå·²æ˜¾ç¤º/æœªæ˜¾ç¤ºï¼‰

---

## é˜¶æ®µ5ï¼š3Dæ¨¡å‹åŠ¨æ€ç¼–è¾‘ï¼ˆé«˜çº§åŠŸèƒ½ï¼‰

> **ç›®æ ‡**ï¼šæ”¯æŒåœ¨3Dåœºæ™¯ä¸­åŠ¨æ€æ·»åŠ å’Œè°ƒæ•´å¤–éƒ¨æ¨¡å‹
> **ä¾èµ–**ï¼šé˜¶æ®µ3
> **é¢„è®¡æ—¶é—´**ï¼š2å‘¨

### 5.1 é™„åŠ å¤–éƒ¨æ¨¡å‹ (MVP)

äº¤äº’æµç¨‹ï¼š

1. ç‚¹å‡»"æ·»åŠ å¤–éƒ¨æ¨¡å‹"æŒ‰é’®
2. ä¸Šä¼ GLB/STEP -> ä¿å­˜åˆ°assets/
3. å¼¹çª—å¡«å†™: æ¨¡å‹åç§°ã€BOMåºå·ã€å…³è”æ­¥éª¤
4. TransformControlsæ‹–æ‹½å¯¹é½
5. ç¡®è®¤ -> å†™å…¥draft.json
6. [ä¿å­˜è‰ç¨¿] -> [å‘å¸ƒ]

æ•°æ®ç»“æ„ï¼š

```json
{
  "step_number": 5,
  "external_models": [{
    "url": "/api/manual/{task_id}/assets/extra.glb",
    "name": "é¢å¤–æ”¯æ¶",
    "bom_seq": "99",
    "matrix": [16ä¸ªæ•°å­—çš„å˜æ¢çŸ©é˜µ],
    "visible_from_step": 5
  }]
}
```



### 5.2 æ’å…¥æ–°æ­¥éª¤ (è¿›é˜¶ï¼Œå¯é€‰)

- åœ¨æ­¥éª¤ä¹‹é—´æ’å…¥æ–°æ­¥éª¤
- è‡ªåŠ¨é‡æ–°ç¼–å·åç»­æ­¥éª¤
- å¤æ‚åº¦é«˜ï¼Œå»ºè®®é˜¶æ®µ5çš„MVPç¨³å®šåå†å®ç°

---

## è¾“å‡ºç›®å½•ç»“æ„
output/{pdfæ–‡ä»¶å}/                    # task_id = PDFæ–‡ä»¶åï¼ˆå»åç¼€ï¼‰
â”œâ”€â”€ assembly_manual.json              # âœ… å·²å‘å¸ƒç‰ˆæœ¬ï¼ˆå·¥äººæŸ¥çœ‹ï¼‰
â”œâ”€â”€ draft.json                        # âœ… è‰ç¨¿ç‰ˆæœ¬ï¼ˆç¼–è¾‘å™¨ä½¿ç”¨ï¼‰
â”œâ”€â”€ versions/                         # âœ… ç‰ˆæœ¬å½’æ¡£ç›®å½•
â”‚   â”œâ”€â”€ v1.json                       #    ç‰ˆæœ¬1
â”‚   â”œâ”€â”€ v2.json                       #    ç‰ˆæœ¬2
â”‚   â””â”€â”€ version_history.json          #    ç‰ˆæœ¬å†å²å…ƒæ•°æ®
â”œâ”€â”€ planning_result.json              # ğŸ“‹ SimplePlannerç”Ÿæˆï¼ˆæ›¿ä»£Agent1ï¼‰
â”œâ”€â”€ bom_data.json                     #[object Object]å–ç»“æœ
â”œâ”€â”€ matching_result.[object Object]OM-3DåŒ¹é…ç»“æœ
â”œâ”€â”€ agent_output.json                 # ğŸ“‹ AgentåŸå§‹è¾“å‡º
â”œâ”€â”€ glb_files/                        # ğŸ¨ 3Dæ¨¡å‹æ–‡ä»¶
â”‚   â”œâ”€â”€ part_001.glb
â”‚   â”œâ”€â”€ part_002.glb
â”‚   â””â”€â”€ assembly.glb
â”œâ”€â”€ pdf_images/                       # ğŸ“„ PDFè½¬å›¾ç‰‡
â”‚   â”œâ”€â”€ page_1.png
â”‚   â””â”€â”€ page_2.png
â”œâ”€â”€ pdf_files/                        # ğŸ“„ åŸå§‹PDFæ–‡ä»¶
â”‚   â””â”€â”€ {task_id}.pdf
â”œâ”€â”€ step_files/                       # ğŸ“„ åŸå§‹STEPæ–‡ä»¶
â”‚   â””â”€â”€ {task_id}.step
â””â”€â”€ assets/                           # ğŸ¨ å¤–éƒ¨ä¸Šä¼ çš„æ¨¡å‹ï¼ˆé˜¶æ®µ5ï¼‰
    â”œâ”€â”€ extra_model_1.glb
    â””â”€â”€ extra_model_2.glb


---

## æ‰§è¡Œæ¸…å•

### Phase 1: ç‰ˆæœ¬æ§åˆ¶
- [ ] [Backend] åˆ›å»º core/storage.py å®ç° ManualStorage ç±» (å«è¿ç§»é€»è¾‘)
- [ ] [Backend] æ”¹é€  simple_app.py æ–°å¢ç‰ˆæœ¬API
- [ ] [Frontend] æ‹†åˆ† ManualViewer ä¸º Viewer å’Œ Editor é¡µé¢
- [ ] [Frontend] Editoré¡µé¢å¢åŠ ç‰ˆæœ¬å†å²å’Œå‘å¸ƒæŒ‰é’®
- [ ] [Frontend] Editoré¡µé¢æ–°å¢"æ­¥éª¤æè¿°"ç¼–è¾‘tab (éœ€æ±‚8)
- [ ] [Testing] æµ‹è¯•æ—§æ•°æ®è¿ç§»åŠŸèƒ½

### Phase 2: STEPè½¬GLBç¼–ç ä¿®å¤
- [ ] [Backend] å®ç° StepToGlbConverter ç±»
- [ ] [Backend] é›†æˆ chardet åº“è¿›è¡Œç¼–ç æ£€æµ‹
- [ ] [Backend] æµ‹è¯•å„ç§ç¼–ç çš„STEPæ–‡ä»¶è½¬æ¢
- [ ] [Backend] å®ç° GlbNameFixer ç±»
- [ ] [Backend] æµ‹è¯•GLBæ–‡ä»¶ç»“æ„è§£æå’Œä¿®æ”¹
- [ ] [Backend] éªŒè¯ä¿®å¤åçš„GLBæ–‡ä»¶å®Œæ•´æ€§
- [ ] [Backend] åœ¨ gemini_pipeline.py ä¸­é›†æˆç¼–ç ä¿®å¤æµç¨‹
- [ ] [Backend] æ·»åŠ é™çº§å¤„ç†æœºåˆ¶
- [ ] [Testing] å®Œæ•´æµç¨‹æµ‹è¯•

### Phase 3: æ™ºèƒ½è¯†åˆ«ä¸å•æ¬¡ä¸Šä¼ 
- [ ] [Backend] æ–°å¢ core/simple_planner.py (æ›¿ä»£Agent1)
- [ ] [Backend] é‡æ„ file_classifier.py å¢åŠ BOMå†…å®¹åˆ†æ
- [ ] [Backend] æ–°å¢ upload_single/generate_single æ¥å£
- [ ] [Frontend] æ”¹é€  Generator.vue ä¸ºå•æ–‡ä»¶ä¸Šä¼ UI
- [ ] [Prompt] ä¿®æ”¹ Agent3/4 æç¤ºè¯å¼ºåˆ¶BOMåºå·æ’åº

### Phase 4: ç§»åŠ¨ç«¯é€‚é…
- [ ] [Frontend] ManualViewer å¢åŠ æ‰‹æœºç«¯ä¸“å±å¸ƒå±€
- [ ] [Frontend] å®ç°æ»‘åŠ¨æ‰‹åŠ¿åˆ‡æ¢æ­¥éª¤
- [ ] [Frontend] æ·»åŠ åº•éƒ¨å¤§æŒ‰é’®å¯¼èˆª
- [ ] [Frontend] å®ç°è‡ªåŠ¨æ’­æ”¾åŠŸèƒ½
- [ ] [Frontend] ThreeViewer å®ç°é€æ­¥æ˜¾ç¤ºé€»è¾‘

### Phase 5: 3Dæ¨¡å‹åŠ¨æ€ç¼–è¾‘
- [ ] [Backend] åç«¯èµ„äº§ä¸Šä¼ æ¥å£
- [ ] [Frontend] å‰ç«¯TransformControlsé›†æˆ
- [ ] [Frontend] external_modelsæ•°æ®ä¿å­˜ä¸å›æ˜¾
- [ ] [Frontend] (å¯é€‰) æ­¥éª¤æ’å…¥ä¸é‡æ–°ç¼–å·é€»è¾‘


