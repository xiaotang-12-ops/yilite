# Release Notes - v1.1.5

**发布日期**: 2025-11-12

## 🎉 重大更新

本版本新增了**管理员登录和在线编辑功能**，允许用户在查看装配说明书时直接编辑内容，无需重新生成！

---

## ✨ 新增功能

### 1. 管理员登录系统
- ✅ 新增管理员登录功能
- ✅ 默认密码：`admin123`（可在前端代码中修改）
- ✅ 登录后显示"编辑内容"按钮
- ✅ 支持退出登录

### 2. 在线编辑功能
- ✅ **焊接要求编辑**：
  - 修改焊接类型、焊缝尺寸、焊接位置
  - 添加/删除焊接要求
  - 限制每个步骤只能有一个焊接要求（符合后端数据结构）
  
- ✅ **安全警告编辑**：
  - 添加/修改/删除安全警告
  - 支持多条安全警告
  
- ✅ **质检要求编辑**：
  - 修改质检要求文本
  - 支持富文本输入

### 3. 组件名称修改
- ✅ 支持修改组件名称
- ✅ 使用唯一 `step_id` 精确匹配，避免误更新
- ✅ 修改后实时同步到前端显示
- ✅ 自动保存到后端 JSON 文件

### 4. 数据持久化
- ✅ 所有编辑内容自动保存到 `output/{task_id}/assembly_manual.json`
- ✅ 自动递增版本号（格式：`major.minor`）
- ✅ 添加 `lastUpdated` 时间戳
- ✅ 支持刷新页面后数据保持

---

## 🐛 Bug 修复

### 1. 组件名称更新问题
- **问题**：修改组件名称后，前端显示没有更新
- **原因**：前端显示的是 `component.component_name`（组件级别），但代码只更新了 `step.component_name`（步骤级别）
- **修复**：同时更新组件级别和步骤级别的 `component_name`

### 2. 焊接要求添加问题
- **问题**：添加第二个焊接要求后无法保存
- **原因**：后端数据结构 `step.welding` 是单个对象，不支持数组
- **修复**：限制每个步骤只能添加一个焊接要求，并在 UI 上提示用户

### 3. 质检显示问题
- **问题**：质检标签页显示了所有步骤的质检要求
- **原因**：计算属性返回了所有步骤的质检
- **修复**：新增 `currentStepQualityCheck` 计算属性，只返回当前步骤的质检

### 4. 安全警告显示问题
- **问题**：安全警告显示为 `步骤undefined - undefined`
- **原因**：后端数据是字符串数组，前端模板期望对象数组
- **修复**：在计算属性中将字符串数组转换为对象数组

---

## 🔧 技术改进

### 1. 前端优化
- 移除所有调试信息（诊断按钮、调试日志框）
- 优化编辑对话框 UI
- 改进表单验证逻辑
- 添加用户友好的提示信息

### 2. 后端优化
- 使用 `step_id` 精确匹配步骤，避免误更新
- 优化数据保存逻辑
- 改进错误处理

### 3. 数据结构优化
- 统一使用 `component.component_name` 作为显示字段
- 保持数据结构的一致性

---

## 📦 Docker 部署优化

### 1. 新增文件
- ✅ `.env.example`：环境变量配置模板
- ✅ `DOCKER_DEPLOYMENT.md`：详细的 Docker 部署指南
- ✅ `.dockerignore`：优化 Docker 构建

### 2. 部署简化
- 只需 3 步即可完成部署
- 清晰的文档说明
- 完善的故障排除指南

---

## 📝 使用说明

### 管理员登录
1. 打开装配说明书查看页面
2. 点击右上角"管理员登录"按钮
3. 输入密码：`admin123`
4. 登录成功后，点击"编辑内容"按钮

### 编辑内容
1. 在编辑对话框中修改焊接、安全、质检等内容
2. 点击"保存"按钮
3. 系统自动保存到后端文件
4. 刷新页面后内容保持

### 修改组件名称
1. 在编辑对话框中找到"组件名称"输入框
2. 修改组件名称
3. 点击"保存"
4. 组件名称实时更新到界面

---

## ⚠️ 注意事项

1. **焊接要求限制**：每个步骤只能有一个焊接要求，如需修改请先删除现有要求
2. **数据备份**：编辑会直接修改 `assembly_manual.json` 文件，建议定期备份
3. **密码安全**：默认密码为 `admin123`，建议在生产环境中修改
4. **浏览器兼容性**：推荐使用 Chrome、Edge、Firefox 最新版本

---

## 🔄 升级指南

### 从 v1.1.4 升级到 v1.1.5

#### Docker 部署用户
```bash
# 1. 拉取最新代码
git pull

# 2. 重新构建镜像
docker-compose build

# 3. 重启服务
docker-compose up -d
```

#### 本地开发用户
```bash
# 1. 拉取最新代码
git pull

# 2. 更新前端依赖（如有变化）
cd frontend
npm install

# 3. 重新构建前端
npm run build

# 4. 重启后端服务
cd ..
python backend/simple_app.py
```

---

## 📊 版本对比

| 功能 | v1.1.4 | v1.1.5 |
|------|--------|--------|
| 管理员登录 | ❌ | ✅ |
| 在线编辑 | ❌ | ✅ |
| 组件名称修改 | ❌ | ✅ |
| 焊接要求编辑 | ❌ | ✅ |
| 安全警告编辑 | ❌ | ✅ |
| 质检要求编辑 | ❌ | ✅ |
| 数据持久化 | ✅ | ✅ |
| Docker 部署 | ✅ | ✅ |

---

## 🙏 致谢

感谢所有用户的反馈和建议！

---

## 📞 支持

如有问题或建议，请：
- 提交 [GitHub Issue](https://github.com/xiaotang-12-ops/Mecagent/issues)
- 查看 [文档](README.md)
- 查看 [Docker 部署指南](DOCKER_DEPLOYMENT.md)

---

**祝你使用愉快！** 🎉

