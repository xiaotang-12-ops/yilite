# é¡¹ç›®äº¤æ¥æ–‡æ¡£

**äº¤æ¥æ—¶é—´**: 2025-10-01  
**é¡¹ç›®åç§°**: æ™ºèƒ½è£…é…è¯´æ˜ä¹¦ç”Ÿæˆç³»ç»Ÿ  
**å½“å‰çŠ¶æ€**: å¼€å‘ä¸­ï¼Œå‰4ä¸ªæ­¥éª¤åŸºæœ¬å®Œæˆï¼Œå­˜åœ¨è‹¥å¹²å¾…ä¿®å¤é—®é¢˜

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
3. [æ ¸å¿ƒæµç¨‹](#æ ¸å¿ƒæµç¨‹)
4. [å·²å®Œæˆçš„å·¥ä½œ](#å·²å®Œæˆçš„å·¥ä½œ)
5. [å½“å‰é—ç•™é—®é¢˜](#å½“å‰é—ç•™é—®é¢˜)
6. [å…³é”®æ–‡ä»¶è¯´æ˜](#å…³é”®æ–‡ä»¶è¯´æ˜)
7. [ä¸‹ä¸€æ­¥å·¥ä½œå»ºè®®](#ä¸‹ä¸€æ­¥å·¥ä½œå»ºè®®)

---

## é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®ç›®æ ‡
å°†PDFå·¥ç¨‹å›¾çº¸ + STEP 3Dæ¨¡å‹ â†’ è‡ªåŠ¨ç”Ÿæˆäº¤äº’å¼HTMLè£…é…è¯´æ˜ä¹¦

### æŠ€æœ¯æ ˆ
- **åç«¯**: Python + FastAPI + WebSocket
- **å‰ç«¯**: Vue 3 + TypeScript + Element Plus
- **AIæ¨¡å‹**: 
  - Qwen-VL (è§†è§‰åˆ†æ)
  - DeepSeek (æ™ºèƒ½åŒ¹é…å’Œæ¨ç†)
- **3Då¤„ç†**: trimesh (STEPâ†’GLBè½¬æ¢)

### æ ¸å¿ƒä»·å€¼
- è‡ªåŠ¨åŒ–ï¼šå‡å°‘äººå·¥ç¼–å†™è£…é…è¯´æ˜ä¹¦çš„æ—¶é—´
- æ™ºèƒ½åŒ–ï¼šAIç†è§£å›¾çº¸å’Œ3Dæ¨¡å‹ï¼Œè‡ªåŠ¨åŒ¹é…é›¶ä»¶
- å¯è§†åŒ–ï¼šç”Ÿæˆå¸¦çˆ†ç‚¸åŠ¨ç”»çš„äº¤äº’å¼è¯´æ˜ä¹¦

---

## ç³»ç»Ÿæ¶æ„

### åç«¯æ¶æ„
```
backend/
â”œâ”€â”€ app.py                    # FastAPIä¸»åº”ç”¨ï¼ŒWebSocketæœåŠ¡
â”œâ”€â”€ websocket_manager.py      # WebSocketè¿æ¥ç®¡ç†
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ parallel_pipeline.py  # å¹¶è¡Œå¤„ç†æµæ°´çº¿ï¼ˆæ ¸å¿ƒï¼‰
â”‚   â””â”€â”€ dual_channel_parser.py # åŒé€šé“PDFè§£æï¼ˆæ–‡æœ¬+è§†è§‰ï¼‰
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ vision_model.py       # Qwen-VLè§†è§‰æ¨¡å‹å°è£…
â”‚   â””â”€â”€ assembly_expert.py    # DeepSeekä¸“å®¶æ¨¡å‹å°è£…
â”œâ”€â”€ processors/
â”‚   â””â”€â”€ file_processor.py     # PDFå’Œ3Dæ¨¡å‹å¤„ç†
â””â”€â”€ generators/
    â””â”€â”€ html_generator.py     # HTMLè¯´æ˜ä¹¦ç”Ÿæˆ
```

### å‰ç«¯æ¶æ„
```
frontend/src/
â”œâ”€â”€ views/
â”‚   â”œâ”€â”€ Generator.vue         # ä¸»ç”Ÿæˆç•Œé¢
â”‚   â””â”€â”€ Settings.vue          # APIå¯†é’¥é…ç½®
â””â”€â”€ components/
    â””â”€â”€ ProcessingSteps.vue   # æ­¥éª¤è¿›åº¦å±•ç¤ºç»„ä»¶ï¼ˆæ–°ï¼‰
```

### æ•°æ®æµ
```
ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶
    â†“
FastAPIæ¥æ”¶ â†’ åˆ›å»ºä»»åŠ¡ â†’ å»ºç«‹WebSocket
    â†“
ParallelAssemblyPipeline.process()
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é€šé“1      â”‚  é€šé“2      â”‚  é€šé“3      â”‚
â”‚  PDFè§£æ    â”‚  STEPâ†’GLB   â”‚  è§†è§‰åˆ†æ   â”‚
â”‚  (pypdf)    â”‚  (trimesh)  â”‚  (Qwen-VL)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
DeepSeekæ™ºèƒ½åŒ¹é… (BOM â†” GLBé›¶ä»¶)
    â†“
ç”Ÿæˆçˆ†ç‚¸åŠ¨ç”» + HTMLè¯´æ˜ä¹¦
    â†“
WebSocketæ¨é€ç»“æœ â†’ å‰ç«¯å±•ç¤º
```

---

## æ ¸å¿ƒæµç¨‹

### å®Œæ•´çš„5ä¸ªæ­¥éª¤

#### **æ­¥éª¤1: pypdfè§£æBOM**
- **æ–‡ä»¶**: `processors/file_processor.py` - `PDFProcessor.extract_text()`
- **åŠŸèƒ½**: ä»PDFä¸­æå–æ–‡æœ¬ï¼Œè¯†åˆ«BOMè¡¨
- **è¾“å‡º**: 53ä¸ªBOMé¡¹ï¼ˆç¤ºä¾‹æ•°æ®ï¼‰
- **æ—¥å¿—**: 
  - `ğŸ“„ å¼€å§‹PDFæ–‡æœ¬æå–`
  - `âœ… PDFæ–‡æœ¬æå–å®Œæˆ: 53ä¸ªBOMé¡¹`

#### **æ­¥éª¤2: STEPâ†’GLBè½¬æ¢ + è§£æé›¶ä»¶**
- **æ–‡ä»¶**: `processors/file_processor.py` - `ModelProcessor.step_to_glb()`
- **åŠŸèƒ½**: 
  1. ä½¿ç”¨trimeshå°†STEPæ–‡ä»¶è½¬æ¢ä¸ºGLBæ ¼å¼
  2. æå–é›¶ä»¶ä¿¡æ¯ï¼ˆèŠ‚ç‚¹åç§°ã€å‡ ä½•ä½“ï¼‰
- **è¾“å‡º**: GLBæ–‡ä»¶ + é›¶ä»¶åˆ—è¡¨
- **æ—¥å¿—**:
  - `ğŸ”„ å¼€å§‹STEPâ†’GLBè½¬æ¢ï¼Œå…±Xä¸ªæ–‡ä»¶`
  - `âœ… STEPâ†’GLBè½¬æ¢å®Œæˆ: Xä¸ªæ–‡ä»¶, å…±Yä¸ªé›¶ä»¶`
- **âš ï¸ å·²ä¿®å¤é—®é¢˜**: å­—æ®µåä¸åŒ¹é…ï¼ˆ`parts_count` vs `part_count`ï¼‰

#### **æ­¥éª¤3: Qwen-VLè§†è§‰åˆ†æ**
- **æ–‡ä»¶**: `core/dual_channel_parser.py` - `_vision_channel_parse()`
- **åŠŸèƒ½**: 
  1. å°†PDFæ¯ä¸€é¡µè½¬ä¸ºå›¾ç‰‡
  2. ç»“åˆBOMä¸Šä¸‹æ–‡ï¼Œè°ƒç”¨Qwen-VLåˆ†æè£…é…å…³ç³»
- **è¾“å‡º**: è£…é…å…³ç³»ã€æŠ€æœ¯è¦æ±‚
- **æ—¥å¿—**:
  - `ğŸ¤– Qwen-VLè§†è§‰æ™ºèƒ½ä½“å¯åŠ¨ï¼Œåˆ†æXé¡µå›¾çº¸...`
  - `âœ… Qwen-VLè§†è§‰åˆ†æå®Œæˆ: Xä¸ªè£…é…å…³ç³», Yä¸ªæŠ€æœ¯è¦æ±‚`
- **âš ï¸ å½“å‰é—®é¢˜**: JSONè§£æå¤±è´¥ï¼ˆè§ä¸‹æ–‡ï¼‰

#### **æ­¥éª¤4: DeepSeekæ™ºèƒ½åŒ¹é…**
- **æ–‡ä»¶**: `core/parallel_pipeline.py` - `_generate_assembly_specification()`
- **åŠŸèƒ½**: 
  1. æ¥æ”¶BOMæ•°æ® + GLBé›¶ä»¶æ•°æ® + è§†è§‰åˆ†æç»“æœ
  2. è°ƒç”¨DeepSeekè¿›è¡Œæ™ºèƒ½åŒ¹é…
  3. ç”Ÿæˆè£…é…è§„èŒƒï¼ˆé›¶ä»¶å¯¹åº”å…³ç³» + è£…é…æ­¥éª¤ï¼‰
- **è¾“å‡º**: è£…é…è§„èŒƒJSON
- **æ—¥å¿—**:
  - `ğŸ¤– DeepSeekå¼€å§‹åŒ¹é…BOMå’ŒGLBé›¶ä»¶...`
  - `âœ… DeepSeekåŒ¹é…å®Œæˆ: Xä¸ªé›¶ä»¶, Yä¸ªè£…é…æ­¥éª¤, åŒ¹é…ç‡Z%`
- **âš ï¸ å½“å‰é—®é¢˜**: åŒ¹é…ç»“æœæ˜¾ç¤º0ï¼ˆè§ä¸‹æ–‡ï¼‰

#### **æ­¥éª¤5: ç”Ÿæˆè¯´æ˜ä¹¦**
- **æ–‡ä»¶**: `generators/html_generator.py`
- **åŠŸèƒ½**: 
  1. ç”Ÿæˆçˆ†ç‚¸åŠ¨ç”»æ•°æ®
  2. ç”ŸæˆHTMLäº¤äº’å¼è¯´æ˜ä¹¦
- **è¾“å‡º**: `index.html` + ç›¸å…³èµ„æº
- **çŠ¶æ€**: â³ å¾…ä¼˜åŒ–ï¼ˆç”¨æˆ·è¦æ±‚æœ€åè®¨è®ºï¼‰

---

## å·²å®Œæˆçš„å·¥ä½œ

### 1. å‰ç«¯UIé‡æ„ âœ…
- **æ–°ç»„ä»¶**: `frontend/src/components/ProcessingSteps.vue`
- **åŠŸèƒ½**:
  - ä½¿ç”¨Element Plusæ—¶é—´çº¿å±•ç¤º6ä¸ªæ­¥éª¤
  - å®æ—¶æ˜¾ç¤ºå…³é”®æ•°æ®ï¼ˆBOMé¡¹æ•°ã€é›¶ä»¶æ•°ã€åŒ¹é…ç‡ç­‰ï¼‰
  - å®æ—¶æ—¥å¿—æ»šåŠ¨æ˜¾ç¤º
  - æ ¹æ®æ—¥å¿—å†…å®¹è‡ªåŠ¨æ›´æ–°æ­¥éª¤çŠ¶æ€
- **æ–‡ä»¶ä¿®æ”¹**:
  - `frontend/src/views/Generator.vue` - é›†æˆæ–°ç»„ä»¶ï¼Œæ·»åŠ `updateStepByLog()`å‡½æ•°

### 2. APIå¯†é’¥é…ç½®ç•Œé¢ âœ…
- **æ–°é¡µé¢**: `frontend/src/views/Settings.vue`
- **åŠŸèƒ½**:
  - å‰ç«¯è¾“å…¥DashScopeå’ŒDeepSeek API Key
  - ä¿å­˜åˆ°localStorage
  - åç«¯APIæ¥æ”¶å¹¶æ›´æ–°ç¯å¢ƒå˜é‡
- **åç«¯API**:
  - `POST /api/settings` - æ›´æ–°APIå¯†é’¥
  - `GET /api/settings` - æŸ¥çœ‹å½“å‰é…ç½®ï¼ˆè„±æ•ï¼‰

### 3. WebSocketè¿›åº¦æŠ¥å‘Š âœ…
- **æ–‡ä»¶**: `backend/websocket_manager.py`
- **ä¿®å¤**: äº‹ä»¶å¾ªç¯é”™è¯¯
  - ä½¿ç”¨`asyncio.run_coroutine_threadsafe()`
  - ä¿å­˜ä¸»äº‹ä»¶å¾ªç¯å¼•ç”¨
- **åŠŸèƒ½**: å®æ—¶æ¨é€æ—¥å¿—å’Œè¿›åº¦åˆ°å‰ç«¯

### 4. è¯¦ç»†æ—¥å¿—è¾“å‡º âœ…
- **ä¿®æ”¹æ–‡ä»¶**:
  - `core/parallel_pipeline.py` - æ·»åŠ STEPâ†’GLBè½¬æ¢æ—¥å¿—
  - `core/dual_channel_parser.py` - æ·»åŠ è§†è§‰åˆ†ææ—¥å¿—
- **æ—¥å¿—çº§åˆ«**: info, success, warning, error

### 5. é”™è¯¯å¤„ç†å¢å¼º âš ï¸ éƒ¨åˆ†å®Œæˆ
- **å·²æ·»åŠ **: 
  - å¹¶è¡Œä»»åŠ¡å¼‚å¸¸æ•è·
  - GLBè½¬æ¢å¤±è´¥æ£€æµ‹
  - PDFè§£æå¤±è´¥æ£€æµ‹
- **å¾…å®Œæˆ**: 
  - è§†è§‰åˆ†æå¤±è´¥çš„é‡è¯•æœºåˆ¶
  - é”™è¯¯æ—¶ç«‹å³åœæ­¢æµç¨‹

---

## å½“å‰é—ç•™é—®é¢˜

### ğŸ”´ é—®é¢˜1: Qwen-VLè¿”å›JSONè§£æå¤±è´¥

**é”™è¯¯ä¿¡æ¯**:
```
[WARNING] âš ï¸ Qwen-VLè¿”å›çš„JSONä¸å®Œæ•´ï¼Œå°è¯•ä¿®å¤...
[ERROR] âŒ JSONè§£æå¤±è´¥: Expecting ',' delimiter: line 1024 column 8 (char 19518)
```

**åŸå› åˆ†æ**:
1. Qwen-VLè¿”å›çš„JSONå¤ªé•¿ï¼ˆè¶…è¿‡1024è¡Œï¼‰
2. JSONæ ¼å¼ä¸æ­£ç¡®ï¼Œå¯èƒ½æœ‰è¯­æ³•é”™è¯¯
3. å¯èƒ½è¢«æˆªæ–­

**å½“å‰å¤„ç†**:
- æ–‡ä»¶: `core/dual_channel_parser.py` ç¬¬381-464è¡Œ
- ç­–ç•¥: å°è¯•æ™ºèƒ½ä¿®å¤ï¼Œå¤±è´¥åè¿”å›ç©ºæ•°æ®
- **é—®é¢˜**: è¿”å›ç©ºæ•°æ®åï¼Œæ²¡æœ‰è§¦å‘é‡è¯•æœºåˆ¶

**éœ€è¦ä¿®å¤**:
1. âœ… æ·»åŠ é‡è¯•æœºåˆ¶ï¼ˆæœ€å¤š3æ¬¡ï¼‰
2. âœ… ä¼˜åŒ–Qwen-VLçš„promptï¼Œå‡å°‘è¿”å›æ•°æ®é‡
3. âœ… å¢åŠ max_tokensé™åˆ¶
4. âœ… å¦‚æœ3æ¬¡éƒ½å¤±è´¥ï¼Œåº”è¯¥åœæ­¢æµç¨‹å¹¶æŠ¥é”™

**ç›¸å…³ä»£ç ä½ç½®**:
- `core/dual_channel_parser.py` - `_call_assembly_expert_model()` æ–¹æ³•

---

### ğŸ”´ é—®é¢˜2: DeepSeekåŒ¹é…ç»“æœæ˜¾ç¤º0

**é”™è¯¯ä¿¡æ¯**:
```
âœ… DeepSeekåŒ¹é…å®Œæˆ: 0ä¸ªé›¶ä»¶, 0ä¸ªè£…é…æ­¥éª¤, åŒ¹é…ç‡0.0% (0/53)
```

**åŸå› åˆ†æ**:
1. DeepSeekè¿”å›çš„JSONç»“æ„ä¸ä»£ç æœŸæœ›çš„ä¸ä¸€è‡´
2. å­—æ®µåå¯èƒ½æ˜¯ `result.result.parts` è€Œä¸æ˜¯ `result.parts`
3. æˆ–è€…DeepSeekè¿”å›çš„æ˜¯å…¶ä»–å­—æ®µå

**å½“å‰ä»£ç **:
- æ–‡ä»¶: `core/parallel_pipeline.py` ç¬¬437-475è¡Œ
- å°è¯•è¯»å–: `assembly_steps`, `steps`, `parts`, `components`, `bom_mapping`, `mapping`

**éœ€è¦ä¿®å¤**:
1. âœ… æŸ¥çœ‹å®é™…çš„DeepSeekè¿”å›æ•°æ®ç»“æ„
2. âœ… æ£€æŸ¥ `debug_output/assembly_expert_output_*.json` æ–‡ä»¶
3. âœ… æ ¹æ®å®é™…ç»“æ„è°ƒæ•´å­—æ®µæå–é€»è¾‘
4. âœ… æ·»åŠ è°ƒè¯•æ—¥å¿—ï¼Œæ‰“å°å®Œæ•´çš„è¿”å›ç»“æ„

**è°ƒè¯•æ–¹æ³•**:
```python
# åœ¨ parallel_pipeline.py ç¬¬437è¡Œåæ·»åŠ 
print(f"[DEBUG] DeepSeekå®Œæ•´è¿”å›: {json.dumps(result, indent=2, ensure_ascii=False)}")
```

---

### ğŸ”´ é—®é¢˜3: æ­¥éª¤æŠ¥é”™åç»§ç»­æ‰§è¡Œ

**ç”¨æˆ·éœ€æ±‚**:
> "æˆ‘è§‰å¾— æ­¥éª¤ä¸­æœ‰ä¸€ä¸ªç¯èŠ‚æŠ¥é”™å°±åº”è¯¥åœä¸‹æ¥ æ˜¾ç¤ºæŠ¥é”™ä¿¡æ¯ è€Œä¸æ˜¯ä¸€ç›´å¾€ä¸‹è¿è¡Œ"

**å½“å‰é—®é¢˜**:
- è§†è§‰åˆ†æå¤±è´¥åï¼Œè¿”å›ç©ºæ•°æ®ç»§ç»­æ‰§è¡Œ
- åº”è¯¥ç«‹å³åœæ­¢å¹¶åœ¨å‰ç«¯æ˜¾ç¤ºé”™è¯¯

**éœ€è¦ä¿®å¤**:
1. âœ… ä¿®æ”¹ `core/parallel_pipeline.py` ç¬¬162-169è¡Œ
2. âœ… è§†è§‰åˆ†æå¤±è´¥åº”è¯¥ `raise Exception` è€Œä¸æ˜¯è¿”å›ç©ºæ•°æ®
3. âœ… å‰ç«¯æ¥æ”¶åˆ°errorçº§åˆ«çš„æ—¥å¿—åï¼Œåœæ­¢è¿›åº¦æ¡å¹¶æ˜¾ç¤ºé”™è¯¯

**ç›¸å…³ä»£ç **:
```python
# å½“å‰ä»£ç ï¼ˆç¬¬162-169è¡Œï¼‰
try:
    parallel_results["vision"] = future_vision.result()
    if not parallel_results["vision"]:
        # âŒ ä¸åº”è¯¥ç»§ç»­ï¼Œåº”è¯¥æŠ›å‡ºå¼‚å¸¸
        self._log("âš ï¸ è§†è§‰åˆ†ææœªè¿”å›ç»“æœï¼Œå°†ä½¿ç”¨ç©ºæ•°æ®ç»§ç»­", "warning")
        parallel_results["vision"] = []
except Exception as e:
    # âŒ ä¸åº”è¯¥ç»§ç»­ï¼Œåº”è¯¥æŠ›å‡ºå¼‚å¸¸
    self._log(f"âš ï¸ è§†è§‰åˆ†æå¤±è´¥: {str(e)}ï¼Œå°†ä½¿ç”¨ç©ºæ•°æ®ç»§ç»­", "warning")
    parallel_results["vision"] = []
```

**åº”è¯¥æ”¹ä¸º**:
```python
try:
    parallel_results["vision"] = future_vision.result()
    if not parallel_results["vision"]:
        raise Exception("è§†è§‰åˆ†ææœªè¿”å›ç»“æœ")
except Exception as e:
    error_msg = f"è§†è§‰åˆ†æå¤±è´¥: {str(e)}"
    self._log(f"âŒ {error_msg}", "error")
    raise Exception(error_msg)  # ç«‹å³åœæ­¢
```

---

### ğŸŸ¡ é—®é¢˜4: å…³é”®ä¿¡æ¯ä¸å¤Ÿè¯¦ç»†

**ç”¨æˆ·éœ€æ±‚**:
> "å…³é”®ä¿¡æ¯æˆ‘è§‰å¾— ä¸å¤Ÿè¯¦ç»† å¯ä»¥æŠŠæ—¥å¿—ä¸­çš„è¯¦ç»†ä¿¡æ¯ æ”¾åœ¨æ¯ä¸ªé˜¶æ®µå®Œæˆåçš„å…³é”®ä¿¡æ¯ä¸Š"

**å½“å‰çŠ¶æ€**:
- å‰ç«¯å·²ç»æ·»åŠ äº† `è¯¦ç»†ä¿¡æ¯` å­—æ®µ
- ä½†æ˜¾ç¤ºæ•ˆæœå¯èƒ½ä¸å¤Ÿæ˜æ˜¾

**éœ€è¦ä¼˜åŒ–**:
1. âœ… åœ¨ `ProcessingSteps.vue` ä¸­ï¼Œå°† `è¯¦ç»†ä¿¡æ¯` å•ç‹¬æ˜¾ç¤º
2. âœ… ä½¿ç”¨æ›´å¤§çš„å­—ä½“æˆ–ä¸åŒçš„é¢œè‰²
3. âœ… å¯ä»¥è€ƒè™‘ä½¿ç”¨æŠ˜å é¢æ¿å±•ç¤ºè¯¦ç»†ä¿¡æ¯

---

## å…³é”®æ–‡ä»¶è¯´æ˜

### åç«¯æ ¸å¿ƒæ–‡ä»¶

#### 1. `backend/app.py`
- **ä½œç”¨**: FastAPIä¸»åº”ç”¨
- **å…³é”®åŠŸèƒ½**:
  - `/api/generate` - å¯åŠ¨ç”Ÿæˆä»»åŠ¡
  - `/ws/{task_id}` - WebSocketè¿æ¥
  - `/api/settings` - APIå¯†é’¥é…ç½®
- **å…³é”®å˜é‡**:
  - `api_keys` - å…¨å±€APIå¯†é’¥å­—å…¸
  - `ws_manager` - WebSocketç®¡ç†å™¨å®ä¾‹

#### 2. `core/parallel_pipeline.py`
- **ä½œç”¨**: å¹¶è¡Œå¤„ç†æµæ°´çº¿ï¼ˆæœ€æ ¸å¿ƒï¼‰
- **å…³é”®æ–¹æ³•**:
  - `process()` - ä¸»æµç¨‹å…¥å£
  - `_process_models_with_progress()` - STEPâ†’GLBè½¬æ¢
  - `_generate_assembly_specification()` - DeepSeekåŒ¹é…
- **å…³é”®å˜é‡**:
  - `progress_reporter` - è¿›åº¦æŠ¥å‘Šå™¨
  - `parallel_results` - å¹¶è¡Œä»»åŠ¡ç»“æœ

#### 3. `core/dual_channel_parser.py`
- **ä½œç”¨**: åŒé€šé“PDFè§£æ
- **å…³é”®æ–¹æ³•**:
  - `parse()` - ä¸»å…¥å£
  - `_text_channel_parse()` - æ–‡æœ¬é€šé“ï¼ˆpypdfï¼‰
  - `_vision_channel_parse()` - è§†è§‰é€šé“ï¼ˆQwen-VLï¼‰
  - `_call_assembly_expert_model()` - è°ƒç”¨Qwen-VL
- **âš ï¸ é—®é¢˜åŒºåŸŸ**: ç¬¬381-464è¡Œï¼ˆJSONè§£æï¼‰

#### 4. `processors/file_processor.py`
- **ä½œç”¨**: æ–‡ä»¶å¤„ç†
- **å…³é”®ç±»**:
  - `PDFProcessor` - PDFå¤„ç†
  - `ModelProcessor` - 3Dæ¨¡å‹å¤„ç†
- **å…³é”®æ–¹æ³•**:
  - `step_to_glb()` - STEPè½¬GLB
  - **âš ï¸ æ³¨æ„**: è¿”å›å­—æ®µæ˜¯ `parts_count` ä¸æ˜¯ `part_count`

#### 5. `models/assembly_expert.py`
- **ä½œç”¨**: DeepSeekä¸“å®¶æ¨¡å‹å°è£…
- **å…³é”®æ–¹æ³•**:
  - `generate_assembly_specification()` - ç”Ÿæˆè£…é…è§„èŒƒ
- **è¿”å›ç»“æ„**:
```python
{
    "success": True,
    "result": {
        "assembly_steps": [...],
        "parts": [...],
        "bom_mapping": [...]
    },
    "raw_response": "...",
    "token_usage": {...}
}
```

### å‰ç«¯æ ¸å¿ƒæ–‡ä»¶

#### 1. `frontend/src/views/Generator.vue`
- **ä½œç”¨**: ä¸»ç”Ÿæˆç•Œé¢
- **å…³é”®æ–¹æ³•**:
  - `startGeneration()` - å¯åŠ¨ç”Ÿæˆ
  - `connectWebSocket()` - å»ºç«‹WebSocket
  - `handleWebSocketMessage()` - å¤„ç†WebSocketæ¶ˆæ¯
  - `updateStepByLog()` - æ ¹æ®æ—¥å¿—æ›´æ–°æ­¥éª¤çŠ¶æ€
- **å…³é”®å˜é‡**:
  - `processingStepsRef` - æ­¥éª¤ç»„ä»¶å¼•ç”¨
  - `processingProgress` - æ€»è¿›åº¦

#### 2. `frontend/src/components/ProcessingSteps.vue`
- **ä½œç”¨**: æ­¥éª¤è¿›åº¦å±•ç¤º
- **å…³é”®æ–¹æ³•**:
  - `addLog()` - æ·»åŠ æ—¥å¿—
  - `updateStep()` - æ›´æ–°æ­¥éª¤çŠ¶æ€
- **æ­¥éª¤ID**:
  - `pdf_text` - PDFæ–‡æœ¬æå–
  - `step_glb` - STEPâ†’GLBè½¬æ¢
  - `vision` - Qwen-VLè§†è§‰åˆ†æ
  - `matching` - DeepSeekæ™ºèƒ½åŒ¹é…
  - `explosion` - ç”Ÿæˆçˆ†ç‚¸åŠ¨ç”»
  - `html` - ç”ŸæˆHTMLè¯´æ˜ä¹¦

---

## ä¸‹ä¸€æ­¥å·¥ä½œå»ºè®®

### ä¼˜å…ˆçº§1: ä¿®å¤Qwen-VL JSONè§£æå¤±è´¥ ğŸ”´

**ä»»åŠ¡æ¸…å•**:
1. [ ] æ·»åŠ é‡è¯•æœºåˆ¶ï¼ˆæœ€å¤š3æ¬¡ï¼‰
2. [ ] ä¼˜åŒ–Qwen-VLçš„promptï¼Œå‡å°‘è¿”å›æ•°æ®é‡
3. [ ] å¢åŠ `max_tokens`é™åˆ¶ï¼ˆå»ºè®®4000-6000ï¼‰
4. [ ] å¦‚æœ3æ¬¡éƒ½å¤±è´¥ï¼Œåœæ­¢æµç¨‹å¹¶æŠ¥é”™

**ä»£ç ä½ç½®**: `core/dual_channel_parser.py` - `_call_assembly_expert_model()`

**å‚è€ƒä»£ç **:
```python
def _call_assembly_expert_model(self, ...):
    max_retries = 3
    for attempt in range(max_retries):
        try:
            # è°ƒç”¨Qwen-VL
            response = self.vision_model.analyze_with_context(...)
            # è§£æJSON
            parsed_result = json.loads(json_str)
            return parsed_result  # æˆåŠŸ
        except json.JSONDecodeError as e:
            if attempt < max_retries - 1:
                self._log(f"âš ï¸ JSONè§£æå¤±è´¥ï¼Œé‡è¯• {attempt+1}/{max_retries}...", "warning")
                continue
            else:
                # æœ€åä¸€æ¬¡å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸
                raise Exception(f"Qwen-VLè°ƒç”¨å¤±è´¥ï¼ˆå·²é‡è¯•{max_retries}æ¬¡ï¼‰: {str(e)}")
```

---

### ä¼˜å…ˆçº§2: ä¿®å¤DeepSeekåŒ¹é…ç»“æœæ˜¾ç¤º0 ğŸ”´

**ä»»åŠ¡æ¸…å•**:
1. [ ] æŸ¥çœ‹ `debug_output/assembly_expert_output_*.json` æ–‡ä»¶
2. [ ] æ‰“å°DeepSeekå®Œæ•´è¿”å›ç»“æ„
3. [ ] æ ¹æ®å®é™…ç»“æ„è°ƒæ•´å­—æ®µæå–é€»è¾‘
4. [ ] æµ‹è¯•å¹¶éªŒè¯åŒ¹é…ç‡æ­£ç¡®æ˜¾ç¤º

**è°ƒè¯•ä»£ç **:
```python
# åœ¨ core/parallel_pipeline.py ç¬¬437è¡Œåæ·»åŠ 
print(f"[DEBUG] DeepSeekå®Œæ•´è¿”å›:")
print(json.dumps(result, indent=2, ensure_ascii=False))

# åœ¨ç¬¬456è¡Œåæ·»åŠ 
print(f"[DEBUG] parsed_resultç±»å‹: {type(parsed_result)}")
print(f"[DEBUG] parsed_resultå†…å®¹: {parsed_result}")
```

---

### ä¼˜å…ˆçº§3: é”™è¯¯æ—¶ç«‹å³åœæ­¢æµç¨‹ ğŸ”´

**ä»»åŠ¡æ¸…å•**:
1. [ ] ä¿®æ”¹ `core/parallel_pipeline.py` ç¬¬162-169è¡Œ
2. [ ] è§†è§‰åˆ†æå¤±è´¥åº”è¯¥æŠ›å‡ºå¼‚å¸¸
3. [ ] å‰ç«¯æ¥æ”¶erroræ—¥å¿—ååœæ­¢è¿›åº¦æ¡
4. [ ] æ˜¾ç¤ºæ˜æ˜¾çš„é”™è¯¯æç¤º

**å‰ç«¯ä¿®æ”¹**:
```typescript
// åœ¨ Generator.vue çš„ updateStepByLog() ä¸­
if (level === 'error') {
  // åœæ­¢è¿›åº¦
  processingStatus.value = 'exception'
  processingText.value = 'å¤„ç†å¤±è´¥'
  // æ˜¾ç¤ºé”™è¯¯å¯¹è¯æ¡†
  ElMessageBox.alert(message, 'é”™è¯¯', {
    type: 'error',
    confirmButtonText: 'ç¡®å®š'
  })
}
```

---

### ä¼˜å…ˆçº§4: ä¼˜åŒ–å…³é”®ä¿¡æ¯æ˜¾ç¤º ğŸŸ¡

**ä»»åŠ¡æ¸…å•**:
1. [ ] ä¿®æ”¹ `ProcessingSteps.vue`
2. [ ] å°† `è¯¦ç»†ä¿¡æ¯` å•ç‹¬æ˜¾ç¤º
3. [ ] ä½¿ç”¨æŠ˜å é¢æ¿æˆ–å¼¹å‡ºæ¡†
4. [ ] æµ‹è¯•æ˜¾ç¤ºæ•ˆæœ

---

## æµ‹è¯•å»ºè®®

### æµ‹è¯•æ­¥éª¤
1. å¯åŠ¨åç«¯: `python backend/app.py`
2. è®¿é—®å‰ç«¯: `http://localhost:3000`
3. é…ç½®APIå¯†é’¥ï¼ˆSettingsé¡µé¢ï¼‰
4. ä¸Šä¼ æµ‹è¯•æ–‡ä»¶:
   - PDF: å·¥ç¨‹å›¾çº¸
   - STEP: 3Dæ¨¡å‹
5. è§‚å¯Ÿæ—¥å¿—å’Œæ­¥éª¤è¿›åº¦
6. æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯

### æµ‹è¯•é‡ç‚¹
- [ ] Qwen-VLæ˜¯å¦æˆåŠŸè¿”å›æ•°æ®
- [ ] DeepSeekåŒ¹é…ç‡æ˜¯å¦æ­£ç¡®æ˜¾ç¤º
- [ ] é”™è¯¯æ—¶æ˜¯å¦ç«‹å³åœæ­¢
- [ ] å‰ç«¯æ­¥éª¤çŠ¶æ€æ˜¯å¦æ­£ç¡®æ›´æ–°

---

## è”ç³»ä¿¡æ¯

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ä»¥ä¸‹æ–‡æ¡£ï¼š
- `docs/workflow_summary.md` - å®Œæ•´æµç¨‹æ¢³ç†
- `docs/api_key_setup.md` - APIå¯†é’¥é…ç½®æŒ‡å—
- `docs/websocket_fix.md` - WebSocketä¿®å¤è¯´æ˜

**ç¥ä¸‹ä¸€ä½Agentå·¥ä½œé¡ºåˆ©ï¼** ğŸš€

