# 管理员修改流程简明说明

用途：说明管理员在页面上修改内容时，数据如何流转、存在哪、如何保证生效。

## 一句话结论
- 页面展示和修改都基于同一份文件：`output/{task_id}/assembly_manual.json`。前端拉它来渲染，管理员保存后仍写回这份文件（后端会把版本号自动 +1）。

## 管理员如何修改
1) 在说明书查看页点“管理员登录”，账号/密码：`admin/admin123`（只在前端校验）。  
2) 打开“编辑内容”，当前步骤下可改：组件名称、焊接信息、安全警告、质检要求；FAQ 是全局的。  
3) 点击“保存” → 前端把修改后的整份手册 JSON 发送到 `PUT /api/manual/{taskId}`。  
4) 后端覆盖写回 `output/{task_id}/assembly_manual.json`，同时版本号小版本 +1，写入 `lastUpdated`。  
5) 重新打开页面会比对版本号，不一致就重新拉取，因此修改会长期保存在服务器文件里。

## 文件读写（后端）
- 读：`GET /api/manual/{taskId}` 直接读 `output/{task_id}/assembly_manual.json`，把路径占位符 `{task_id}` 替换成真实 taskId 后返回。
- 写：`PUT /api/manual/{taskId}` 接收前端发送的整份 JSON，版本号小版本 +1，写入 `lastUpdated`，然后覆盖写回。
- 版本探测：`HEAD /api/manual/{taskId}/version` 只返回版本号，前端用它判断缓存是否过期。

## 这份文件里有什么（核心字段）
- 组件装配：组件名称、步骤清单、GLB 文件名、图纸路径、全局唯一 `step_id`。
- 产品装配：总装步骤、GLB、图纸路径。
- 质量与安全：步骤级焊接信息、安全警告、质检要求；全局 FAQ。
- 资源映射：3D 资源映射、PDF 图片路径等。

## 当前限制（后续再优化）
- 管理员校验仅在前端，后端未做鉴权。
- 保存是整份文件覆盖，不做并发/字段校验；多窗口同时保存会互相覆盖。
- 前端本地缓存未按 taskId 区分，切换任务后需注意版本比对。
