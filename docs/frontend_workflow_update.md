# å‰ç«¯å·¥ä½œæµæ›´æ–°è¯´æ˜

## ğŸ“‹ æ›´æ–°æ¦‚è¿°

æ ¹æ®æ­£ç¡®çš„å·¥ä½œæµç¨‹ï¼Œå‰ç«¯è¿›åº¦ç•Œé¢å·²æ›´æ–°ä¸º**é¡ºåºå¤„ç†**æ¨¡å¼ï¼Œä½“ç°äº†PDFè§£æå¿…é¡»å…ˆå®Œæˆï¼Œç„¶åæ‰èƒ½è¿›è¡Œåç»­æ­¥éª¤çš„é€»è¾‘ã€‚

---

## ğŸ”„ æ–°çš„å·¥ä½œæµç¨‹

### **å®Œæ•´æµç¨‹å›¾**

```
ç”¨æˆ·ä¸Šä¼ : PDF + STEP
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ1: PDFè§£æ - æå–BOMè¡¨ â­ å¿…é¡»å…ˆå®Œæˆ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. æ–‡æœ¬æå– (pypdf)                      â”‚
â”‚    - æå–BOMè¡¨æ ¼æ•°æ®                     â”‚
â”‚    - è¯†åˆ«é›¶ä»¶ä»£å·ã€åç§°ã€æ•°é‡            â”‚
â”‚                                          â”‚
â”‚ 2. è§†è§‰åˆ†æ (Qwen-VL)                   â”‚
â”‚    - åˆ†æå›¾çº¸ç»“æ„                        â”‚
â”‚    - è¯†åˆ«è£…é…å…³ç³»                        â”‚
â”‚    - æå–æŠ€æœ¯è¦æ±‚                        â”‚
â”‚                                          â”‚
â”‚ 3. ç”ŸæˆBOMè¡¨                            â”‚
â”‚    - åˆå¹¶æ–‡æœ¬å’Œè§†è§‰ç»“æœ                  â”‚
â”‚    - ç”Ÿæˆæœ€ç»ˆBOMå€™é€‰åˆ—è¡¨                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ2: å¹¶è¡Œå¤„ç† - åŸºäºBOMæ•°æ®           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ”¯è·¯1: PDFæ·±åº¦åˆ†æ                       â”‚
â”‚   - è£…é…æ­¥éª¤è¯†åˆ«                         â”‚
â”‚   - ç´§å›ºä»¶ä½¿ç”¨åˆ†æ                       â”‚
â”‚   - æ‰­çŸ©å€¼æå–                           â”‚
â”‚                                          â”‚
â”‚ æ”¯è·¯2: STEPé›¶ä»¶æå–                      â”‚
â”‚   - æå–å‡ ä½•åç§°                         â”‚
â”‚   - ç»Ÿè®¡å®ä¾‹æ•°é‡                         â”‚
â”‚   - ä¿®å¤ç¼–ç é—®é¢˜                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ3: BOM-STEPæ™ºèƒ½åŒ¹é…                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. è§„åˆ™åŒ¹é…                             â”‚
â”‚    - åŸºäºä»£å·åŒ¹é…                        â”‚
â”‚    - åŸºäºè§„æ ¼åŒ¹é…                        â”‚
â”‚    - å®ä¾‹æ•°éªŒè¯                          â”‚
â”‚                                          â”‚
â”‚ 2. DeepSeekæ¨ç†åŒ¹é…                     â”‚
â”‚    - ä¿®å¤ç¼–ç é—®é¢˜                        â”‚
â”‚    - ç»„ä»¶æ‹†è§£                            â”‚
â”‚    - è¯­ä¹‰åŒ¹é…                            â”‚
â”‚                                          â”‚
â”‚ 3. ç”ŸæˆBOM-3Dæ˜ å°„                       â”‚
â”‚    - å»ºç«‹å®Œæ•´å¯¹åº”å…³ç³»                    â”‚
â”‚    - è®¡ç®—æœ€ç»ˆåŒ¹é…ç‡                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ4: ç”Ÿæˆè£…é…è¯´æ˜ä¹¦                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - ç”Ÿæˆè£…é…æ­¥éª¤                           â”‚
â”‚ - åˆ›å»º3Däº¤äº’ç•Œé¢                         â”‚
â”‚ - è¾“å‡ºHTMLæ–‡æ¡£                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ å…³é”®æ”¹åŠ¨

### **1. é˜¶æ®µå®šä¹‰æ›´æ–°**

**æ—§ç‰ˆæœ¬ï¼ˆå¹¶è¡Œå¤„ç†ï¼‰ï¼š**
```javascript
const stages = {
  pdf: 'PDFè§£æä¸åˆ†æ',
  model: '3Dæ¨¡å‹å¤„ç†',
  ai: 'AIæ™ºèƒ½åˆ†æ',
  generate: 'è¯´æ˜ä¹¦ç”Ÿæˆ'
}
```

**æ–°ç‰ˆæœ¬ï¼ˆé¡ºåºå¤„ç†ï¼‰ï¼š**
```javascript
const stages = {
  pdf_bom: 'é˜¶æ®µ1: PDFè§£æ - æå–BOMè¡¨',      // â­ å¿…é¡»å…ˆå®Œæˆ
  parallel: 'é˜¶æ®µ2: å¹¶è¡Œå¤„ç† - åŸºäºBOMæ•°æ®',  // åŸºäºBOM
  matching: 'é˜¶æ®µ3: BOM-STEPæ™ºèƒ½åŒ¹é…',       // åŸºäºBOM
  generate: 'é˜¶æ®µ4: ç”Ÿæˆè£…é…è¯´æ˜ä¹¦'           // æœ€ç»ˆè¾“å‡º
}
```

### **2. é˜¶æ®µ1: PDFè§£æ - æå–BOMè¡¨**

**UIå±•ç¤ºï¼š**
- âœ… æ–‡æœ¬æå– (pypdf)
  - æ˜¾ç¤ºBOMå€™é€‰é¡¹æ•°é‡
  - å®æ—¶è¿›åº¦æ›´æ–°
  
- âœ… è§†è§‰åˆ†æ (Qwen-VL)
  - æ˜¾ç¤ºè£…é…å…³ç³»æ•°é‡
  - æ˜¾ç¤ºæŠ€æœ¯è¦æ±‚æ•°é‡
  
- âœ… ç”ŸæˆBOMè¡¨
  - æ˜¾ç¤ºæœ€ç»ˆBOMé¡¹ç›®æ•°

**æ•°æ®ç»“æ„ï¼š**
```javascript
stageData.pdf_bom = {
  current_task: 'text_extraction' | 'vision_analysis' | 'bom_generation',
  text_extraction: {
    message: 'æå–BOMè¡¨æ ¼æ•°æ®...',
    bom_candidates: 53
  },
  vision_analysis: {
    message: 'åˆ†æå›¾çº¸ç»“æ„å’Œè£…é…å…³ç³»...',
    assembly_relations: 12,
    requirements: 8
  },
  bom_generation: {
    message: 'åˆå¹¶æ–‡æœ¬å’Œè§†è§‰ç»“æœ...',
    total_items: 53
  },
  text_extraction_done: true,
  vision_analysis_done: true,
  bom_generation_done: true
}
```

### **3. é˜¶æ®µ2: å¹¶è¡Œå¤„ç† - åŸºäºBOMæ•°æ®**

**UIå±•ç¤ºï¼š**
- ğŸ“„ PDFæ·±åº¦åˆ†æ
  - è£…é…æ­¥éª¤æ•°é‡
  - ç´§å›ºä»¶æ•°é‡
  
- ğŸ“¦ STEPé›¶ä»¶æå–
  - å”¯ä¸€é›¶ä»¶æ•°é‡
  - æ€»å®ä¾‹æ•°é‡

**æ•°æ®ç»“æ„ï¼š**
```javascript
parallelProgress = {
  pdf_deep: 75,      // PDFæ·±åº¦åˆ†æè¿›åº¦
  step_extract: 60   // STEPé›¶ä»¶æå–è¿›åº¦
}

stageData.pdf_deep = {
  message: 'åˆ†æè£…é…å…³ç³»å’ŒæŠ€æœ¯è¦æ±‚...',
  assembly_steps: 12,
  fasteners: 45
}

stageData.step_extract = {
  message: 'æå–é›¶ä»¶å‡ ä½•åç§°å’Œå®ä¾‹æ•°...',
  unique_parts: 102,
  total_instances: 414
}
```

### **4. é˜¶æ®µ3: BOM-STEPæ™ºèƒ½åŒ¹é…**

**UIå±•ç¤ºï¼š**
- ğŸ”§ è§„åˆ™åŒ¹é…
  - å·²åŒ¹é…æ•°é‡/æ€»BOMæ•°é‡
  - åŒ¹é…ç‡ç™¾åˆ†æ¯”
  
- ğŸ¤– DeepSeekæ¨ç†åŒ¹é…
  - æ–°åŒ¹é…æ•°é‡
  - ç»„ä»¶æ‹†è§£æ•°é‡
  
- âœ… ç”ŸæˆBOM-3Dæ˜ å°„
  - æœ€ç»ˆåŒ¹é…ç‡

**æ•°æ®ç»“æ„ï¼š**
```javascript
stageData.matching = {
  current_task: 'rule_matching' | 'ai_matching' | 'mapping',
  rule_matching: {
    message: 'åŸºäºä»£å·å’Œè§„æ ¼è¿›è¡ŒåŒ¹é…...',
    matched: 23,
    total_bom: 53,
    match_rate: 43.4
  },
  ai_matching: {
    message: 'ä¿®å¤ç¼–ç é—®é¢˜ï¼Œç»„ä»¶æ‹†è§£...',
    new_matches: 19,
    components: 7
  },
  mapping: {
    message: 'å»ºç«‹å®Œæ•´çš„å¯¹åº”å…³ç³»...',
    final_match_rate: 79.2
  },
  rule_matching_done: true,
  ai_matching_done: true,
  mapping_done: true
}
```

---

## ğŸ“ åç«¯éœ€è¦é…åˆçš„æ”¹åŠ¨

### **1. WebSocketæ¶ˆæ¯æ ¼å¼**

**é˜¶æ®µ1: PDFè§£æ**
```python
await websocket.send_json({
    "type": "progress_update",
    "stage": "pdf_bom",
    "progress": 30,
    "message": "æ­£åœ¨æå–BOMè¡¨...",
    "data": {
        "current_task": "text_extraction",
        "text_extraction": {
            "message": "æå–BOMè¡¨æ ¼æ•°æ®...",
            "bom_candidates": 53
        }
    }
})
```

**é˜¶æ®µ2: å¹¶è¡Œå¤„ç†**
```python
await websocket.send_json({
    "type": "progress_update",
    "stage": "parallel",
    "progress": 50,
    "message": "å¹¶è¡Œå¤„ç†ä¸­...",
    "data": {
        "parallel_progress": {
            "pdf_deep": 75,
            "step_extract": 60
        },
        "pdf_deep": {
            "message": "åˆ†æè£…é…å…³ç³»...",
            "assembly_steps": 12
        },
        "step_extract": {
            "message": "æå–é›¶ä»¶åç§°...",
            "unique_parts": 102
        }
    }
})
```

**é˜¶æ®µ3: BOM-STEPåŒ¹é…**
```python
await websocket.send_json({
    "type": "progress_update",
    "stage": "matching",
    "progress": 80,
    "message": "BOM-STEPåŒ¹é…ä¸­...",
    "data": {
        "current_task": "ai_matching",
        "rule_matching": {
            "matched": 23,
            "total_bom": 53,
            "match_rate": 43.4
        },
        "ai_matching": {
            "message": "DeepSeekæ¨ç†ä¸­...",
            "new_matches": 19,
            "components": 7
        },
        "rule_matching_done": true
    }
})
```

---

## âœ… éªŒè¯æ¸…å•

- [x] å‰ç«¯é˜¶æ®µå®šä¹‰å·²æ›´æ–°
- [x] ProcessingVisualizationç»„ä»¶å·²æ›´æ–°
- [x] é˜¶æ®µ1: PDFè§£æUIå·²å®ç°
- [x] é˜¶æ®µ2: å¹¶è¡Œå¤„ç†UIå·²å®ç°
- [x] é˜¶æ®µ3: BOM-STEPåŒ¹é…UIå·²å®ç°
- [ ] åç«¯WebSocketæ¶ˆæ¯æ ¼å¼éœ€è¦æ›´æ–°
- [ ] åç«¯å¤„ç†æµç¨‹éœ€è¦è°ƒæ•´ä¸ºé¡ºåºå¤„ç†

---

## ğŸš€ ä¸‹ä¸€æ­¥

1. **åç«¯è°ƒæ•´**ï¼šä¿®æ”¹core/dual_channel_parser.pyï¼Œå®ç°é¡ºåºå¤„ç†é€»è¾‘
2. **WebSocketæ›´æ–°**ï¼šæ›´æ–°æ¶ˆæ¯æ ¼å¼ï¼ŒåŒ¹é…æ–°çš„é˜¶æ®µå®šä¹‰
3. **æµ‹è¯•éªŒè¯**ï¼šå®Œæ•´æµ‹è¯•æ–°çš„å·¥ä½œæµç¨‹

---

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. **é˜¶æ®µ1å¿…é¡»å…ˆå®Œæˆ**ï¼šPDFè§£ææå–BOMæ˜¯æ‰€æœ‰åç»­æ­¥éª¤çš„åŸºç¡€
2. **é˜¶æ®µ2åŸºäºBOM**ï¼šå¹¶è¡Œå¤„ç†çš„ä¸¤ä¸ªæ”¯è·¯éƒ½ä¾èµ–BOMæ•°æ®
3. **é˜¶æ®µ3åŸºäºBOM**ï¼šåŒ¹é…ç®—æ³•éœ€è¦BOMä½œä¸ºå‚è€ƒ
4. **è¿›åº¦è®¡ç®—**ï¼šæ€»è¿›åº¦ = (é˜¶æ®µ1è¿›åº¦ Ã— 0.3) + (é˜¶æ®µ2è¿›åº¦ Ã— 0.3) + (é˜¶æ®µ3è¿›åº¦ Ã— 0.3) + (é˜¶æ®µ4è¿›åº¦ Ã— 0.1)

