# Agent 输出规范文档

## 概述

本文档定义了8个AI Agent的输出格式、完成标志和状态转换规则，确保前端能够正确显示每个Agent的工作状态。

---

## 核心原则

### 1. **每个Agent必须有明确的生命周期**
- **开始标志** (STARTED)
- **进行中** (RUNNING) - 可选的进度更新
- **完成标志** (COMPLETED/FAILED/SKIPPED) - **必须**

### 2. **状态定义**
```typescript
type AgentStatus = 
  | 'idle'      // 未开始
  | 'running'   // 进行中
  | 'success'   // 成功完成
  | 'warning'   // 完成但有警告
  | 'skipped'   // 跳过（无需处理）
  | 'error'     // 失败
```

### 3. **日志格式规范**
```python
# 开始
self.log_agent_call(agent_name, action, "running")

# 完成（成功）
self.log_agent_call(agent_name, action, "success")

# 完成（跳过）
self.log_agent_call(agent_name, action, "skipped")

# 完成（失败）
self.log_agent_call(agent_name, action, "error")
```

---

## Agent 1: 📂 文件管理员

### 职责
- 分类PDF文件（产品总图 vs 组件图）
- 将PDF转换为图片供AI分析

### 输出时间线
```
[22:02:41] 👷 文件管理AI员工加入工作，他开始查看文件夹里有哪些图纸...
  📄 他发现了 1 个PDF图纸
[22:02:41] 👷 文件管理AI员工加入工作，他开始分辨哪些是产品总图，哪些是组件图...
  [成功] 📋 他找到了产品总图: 产品总图.pdf
  [成功] 🔧 他找到了 0 个组件图
[22:02:41] 👷 文件管理AI员工加入工作，他开始把PDF转换成图片（AI需要看图片）...
  [成功] 🖼️  他转换了 2 张图片
[22:02:42] ✅ 文件管理AI员工完成了工作，他整理好了所有图纸和图片
```

### 关键数据
- PDF文件数量
- 产品总图名称
- 组件图数量
- 转换的图片总数

### 完成条件
- 至少有1个产品总图
- PDF成功转换为图片

---

## Agent 2: 📊 BOM数据分析员

### 职责
- 从PDF图纸中提取BOM表格数据

### 输出时间线
```
[22:02:42] 👷 BOM分析AI员工加入工作，他开始从图纸中读取零件清单...
  📄 他准备从 1 个图纸中提取零件信息
     📖 正在阅读: 产品总图.pdf
  [成功]       提取到 53 个零件
  [成功] 📦 他整理出了 53 个零件的信息
     详细统计:
        • 产品总图.pdf: 53 个零件
[22:02:52] ✅ BOM分析AI员工完成了工作，他生成了完整的零件清单
```

### 关键数据
- 处理的PDF数量
- 每个PDF提取的零件数
- 总零件数

### 完成条件
- 至少提取到1个零件

---

## Agent 3: 🔍 装配规划师

### 职责
- 使用AI视觉分析图纸
- 识别组件结构
- 规划装配顺序

### 输出时间线
```
[22:02:52] 👷 装配规划AI员工加入工作，他开始研究图纸，规划装配顺序...
  🖼️  他拿到了 2 张图片
  📊 他参考了 53 个零件的信息
[22:02:52] 👷 装配规划AI员工加入工作，他开始使用AI视觉分析图纸...
[Agent1_] Calling Gemini 2.5 Flash
[Agent1_] Success
  [成功] 🎯 他识别出了 7 个组件
  [成功] 📋 他制定了装配顺序方案
[22:03:02] ✅ 装配规划AI员工完成了工作，他完成了装配规划方案
```

### 关键数据
- 图片数量
- BOM参考数量
- 识别的组件数
- 基础组件名称

### 完成条件
- AI调用成功
- 识别出至少1个组件

---

## Agent 4: 🎨 3D模型工程师

### 职责
- 将STEP文件转换为GLB格式
- BOM与3D模型零件匹配

### 输出时间线
```
[22:03:02] 👷 3D模型AI员工加入工作，他开始将STEP文件转换成网页能看的GLB格式...
[22:03:02] 👷 3D模型AI员工加入工作，他开始把零件清单和3D模型对应起来...
   🔄 开始加载STEP文件: 产品总图.STEP
   📦 检测到装配体，包含 414 个零件
  [成功] GLB转换成功: 414 个零件
  [成功] 代码匹配完成: BOM 21/41 (45.2%)
  👷 AI匹配员工加入工作，他开始智能分析 227 个未匹配的3D零件...
  [成功] ✅ AI匹配员工完成了工作，他新增匹配了 18 个BOM
  [成功] 总匹配率: BOM 39/41 (95.1%) [代码: 21, AI: 18]
  [成功] 🔧 他处理了 0 个组件的3D模型
  [成功] 📦 他完成了产品总装的3D模型
[22:04:08] ✅ 3D模型AI员工完成了工作，他生成了所有3D模型和零件的对应关系
```

### 关键数据
- STEP文件数量
- 3D零件总数
- BOM匹配率
- 代码匹配数量
- AI匹配数量

### 完成条件
- 至少转换1个GLB文件
- BOM匹配率 > 0%

---

## Agent 5: 🔨 组件装配工程师 ⚠️

### 职责
- 为每个组件编写装配步骤

### ⚠️ **当前问题**
当组件没有图片时，直接跳过，**没有完成标志**！

### 当前输出（有问题）
```
[22:04:08] 👷 组件装配工 #1AI员工加入工作，他开始编写【右力臂推雪组件-漆后】的装配步骤...
  [警告] 未找到组件01.09.2550的图片
[22:04:08] 👷 组件装配工 #2AI员工加入工作，他开始编写【左力臂推雪组件-漆后】的装配步骤...
  [警告] 未找到组件01.09.2551的图片
...
（没有完成标志！）
```

### ✅ **应该的输出**
```
[22:04:08] 👷 组件装配工 #1AI员工加入工作，他开始编写【右力臂推雪组件-漆后】的装配步骤...
  [警告] 未找到组件01.09.2550的图片
[22:04:08] ⚠️ 组件装配工 #1跳过了工作，因为缺少组件图片

[22:04:08] 👷 组件装配工 #2AI员工加入工作，他开始编写【左力臂推雪组件-漆后】的装配步骤...
  [警告] 未找到组件01.09.2551的图片
[22:04:08] ⚠️ 组件装配工 #2跳过了工作，因为缺少组件图片

...

[22:04:08] ✅ 组件装配工程师完成了工作，处理了 0/7 个组件
```

### 关键数据
- 组件总数
- 成功处理的组件数
- 跳过的组件数
- 每个组件的装配步骤数
- BOM覆盖率

### 完成条件
- **每个组件工都必须有完成标志**（成功/跳过/失败）
- 步骤结束时输出总结

---

## Agent 6: 🏗️ 产品总装工程师

### 输出时间线
```
[22:04:08] 👷 产品总装AI员工加入工作，他开始规划如何把组件组装成最终产品...
  📋 他正在研究产品总图
  📋 产品级BOM: 41 个零件
[Agent4_] Calling Gemini 2.5 Flash
[Agent4_] Success
  [成功] ✅ 生成了 6 个总装步骤
  📋 产品级BOM覆盖率: 38/41 (92.7%)
  [警告] ⚠️  有 3 个产品级BOM未覆盖
[22:04:35] ✅ 产品总装AI员工完成了工作，他完成了产品总装说明
```

### 关键数据
- 产品级BOM数量
- 总装步骤数
- BOM覆盖率
- 未覆盖的BOM数量

---

## Agent 7: ⚡ 焊接工程师 & 🛡️ 安全专员

### 职责
- 焊接工程师：为装配步骤添加焊接要点
- 安全专员：为装配步骤添加安全警告和FAQ

### 输出时间线
```
[22:04:35] 👷 焊接工程师AI员工加入工作，他开始为每个装配步骤添加焊接要点...
[Agent5_] Calling Gemini 2.5 Flash
[Agent5_] Success
 ✅ 焊接分析完成:
   - 总步骤数: 6
   - 涉及焊接的步骤: 0
  [成功] ⚡ 焊接要点已嵌入到装配步骤中
[22:05:02] ✅ 焊接工程师AI员工完成了工作，他完成焊接要点标注

[22:05:02] 👷 安全专员AI员工加入工作，他开始为每个装配步骤添加安全警告...
[Agent6_FAQ] Calling Gemini 2.5 Flash
[Agent6_FAQ] Success
 ✅ 安全分析完成:
   - 总步骤数: 6
   - 有安全警告的步骤: 5
   - FAQ条目: 0
  [成功] 🛡️ 安全警告已嵌入到装配步骤中
[22:05:19] ✅ 安全专员AI员工完成了工作，他完成安全警告标注
```

### 关键数据
- 总装配步骤数
- 涉及焊接的步骤数
- 有安全警告的步骤数
- FAQ条目数

---

## Agent 8: 📚 手册编辑员

### 输出时间线
```
[22:05:19] 👷 手册编辑AI员工加入工作，他开始把所有工程师的成果整合成一本完整的说明书...
  📝 他正在整理所有内容...
 ✅ 装配说明书编辑完成:
   - 组件章节: 0
   - 总装步骤: 6
   - 焊接要求: 0
   - 安全警告: 0
   - FAQ: 0
  [成功] 📖 装配说明书编辑完成
[22:05:19] ✅ 手册编辑AI员工完成了工作，他生成了最终的装配说明书
  [成功] 💾 保存到: output\xxx\assembly_manual.json
```

### 关键数据
- 组件章节数
- 总装步骤数
- 焊接要求数
- 安全警告数
- FAQ条目数
- 输出文件路径

---

## 前端卡片状态映射

### 状态颜色
- `idle` → 灰色
- `running` → 蓝色（动画）
- `success` → 绿色
- `warning` → 橙色
- `skipped` → 黄色
- `error` → 红色

### 状态转换规则
```
idle → running → (success | warning | skipped | error)
```

**重要：** 每个Agent必须从 `running` 转换到终态（success/warning/skipped/error），不能停留在 `running` 状态！

