# 📝 更新日志 (Changelog)

本文档记录项目的所有重要更改。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本控制](https://semver.org/lang/zh-CN/)。

---

## [v1.1.7] - 2025-01-14

### ✨ 新增功能

#### 🎨 三色高亮显示系统
- **黄色高亮**：当前步骤正在装配的零件（`color: 0xffff00`，发光强度0.8）
- **绿色高亮**：已完成装配的零件（`color: 0x4CAF50`，发光强度0.3）
- **灰色显示**：尚未装配的零件（`color: 0x808080`，半透明度0.3）

#### 📐 单零件步骤优化
- 每个装配步骤只涉及一个零件，避免操作混淆
- 自动计算新零件：`新零件 = 当前步骤零件 - 前面步骤零件`
- 智能处理焊接等特殊步骤（无新零件时继承上一步高亮）

#### 🔧 技术实现
- **前端高亮逻辑**：`highlightStepParts()` 函数（ManualViewer.vue 第2042行）
- **已装配零件计算**：`assembledMeshes` 计算属性（第945行）
- **后端3D高亮生成**：组件装配Agent自动生成`3d_highlight`字段
- **优先级规则**：黄色 > 绿色 > 灰色

### 🎯 视觉优化
- 高对比度材质设计，适合车间环境
- 发光效果（emissive）增强零件识别度
- 天蓝色基础材质（`0x4A90E2`），清晰锐利

### 📝 文档更新
- 更新README.md，添加v1.1.7功能说明
- 更新版本号至1.1.7
- 添加待开发功能列表

### 🔍 已知限制
- 颜色暂不支持自定义（待v1.1.8实现）
- 装配步骤描述暂不支持在线编辑（待v1.1.8实现）
- 产品总图STEP文件如果简化组件表示，会导致部分零件无法高亮（建模问题，非代码问题）

### 🐛 Bug修复
- 修复组件切换时高亮状态不更新的问题
- 修复首次加载时已装配零件计算错误
- 优化GLB模型切换逻辑

---

## [v1.1.6] - 2025-01-13

### 🐛 Bug修复
- 修复前端数据加载问题
- 优化WebSocket连接稳定性

---

## [v1.1.5] - 2025-01-12

### ✨ 新增功能
- **管理员登录功能**：支持管理员登录后编辑说明书内容
- **在线编辑**：可直接修改焊接要求、安全警告、质检要求
- **组件名称修改**：支持修改组件名称并实时同步
- **数据持久化**：编辑内容自动保存到后端文件

---

## [v1.1.4] - 2025-11-11

### 🐛 Bug修复
- **修复组件步骤过滤BUG**: 恢复双重过滤逻辑（步骤号 + 组件名称），解决不同组件的相同步骤号数据混乱问题
- **修复编辑对话框数据不一致**: 组件名称可被用户手动修改导致数据不匹配
- **修复添加新数据字段错误**: `addWeldingRequirement()` 和 `addSafetyWarning()` 使用了错误的字段 `currentStep.action` 而非 `currentStep.component_name`

### ✨ 改进
- 编辑对话框中步骤号和组件名称设为只读（灰色背景 + 提示文字），防止用户误修改
- 保存时强制使用当前步骤的正确值（`currentStepNumber` 和 `currentComponentName`），确保数据一致性
- 优化删除逻辑，按 `step_number + component` 删除，避免误删其他组件的数据

### 📝 文档
- 更新 `Memory_Development/index.md` 和 `Memory_Development/changelog.md`
- 添加详细的bug修复说明和代码变更记录

### 🔧 技术细节
- **问题根源**: 每个组件都有独立的步骤序列（主框架组件步骤1 ≠ 挂架组件步骤1），v1.1.3 只按步骤号过滤导致数据混乱
- **解决方案**: 恢复双重过滤 + 强制只读 + 保存时强制使用正确值

---

## [v1.1.3] - 2025-11-10

### 🐛 Bug修复
- 尝试优化过滤逻辑（后发现引入了新问题，已在 v1.1.4 修复）

### ⚠️ 已知问题
- 单一步骤号过滤导致不同组件数据混乱（已在 v1.1.4 修复）

---

## [v1.1.2] - 2025-11-09

### 🐛 Bug修复
- 修复编辑对话框数据保存问题
- 优化前端数据加载逻辑

---

## [v1.1.1] - 2025-11-08

### 🐛 Bug修复
- 修复编辑功能的初始bug
- 改进数据同步机制

---

## [v1.1.0] - 2025-11-07

### ✨ 新增功能
- **管理员编辑功能**: 支持在前端页面编辑焊接要求、安全警告和常见问题
- **实时预览**: 编辑后立即在前端页面显示更新内容
- **版本自动递增**: 每次编辑保存后自动递增版本号

### 🎨 界面改进
- 添加"编辑"按钮（仅管理员可见）
- 优化编辑对话框UI设计
- 改进数据展示布局

### 📝 文档
- 创建 `Memory_Development/` 文档系统
- 添加项目快照和API文档

---

## [v1.0.0] - 2025-11-04

### 🎉 首个正式版本

### ✨ 核心功能
- **AI驱动的装配说明书生成**: 使用 Google Gemini 2.0 Flash 模型解析PDF工程图纸和3D模型
- **3D交互式查看**: 基于 Three.js 的3D模型展示，支持旋转、缩放、平移
- **步骤导航**: 清晰的装配步骤导航和进度显示
- **焊接要求**: 详细的焊接工艺要求和参数
- **安全警告**: 每个步骤的安全注意事项
- **质量检查**: 质检要点和标准
- **常见问题**: FAQ 问答

### 🏗️ 技术架构
- **后端**: FastAPI (Python) + Google Gemini 2.0 Flash
- **前端**: Vue 3 + TypeScript + Element Plus + Three.js
- **部署**: Docker + Docker Compose
- **3D处理**: Blender (STEP/STL → GLB)

### 📦 部署
- Docker 容器化部署
- 前后端分离架构
- 数据持久化支持

### 📝 文档
- 完整的 README.md
- Docker 快速启动指南
- API 文档

---

## [v0.0.2] - 2025-10-15

### ✨ 新增功能
- 初步实现装配说明书生成
- 基础的3D模型展示
- 简单的步骤导航

### 🐛 Bug修复
- 修复PDF解析问题
- 修复3D模型加载失败

---

## [v0.0.1] - 2025-10-01

### 🎉 项目初始化
- 创建项目基础结构
- 搭建前后端框架
- 集成 AI 模型

---

## 版本类型说明

- 🎉 **重大更新**: 新版本发布、重要里程碑
- ✨ **新增功能**: 新功能、新特性
- 🐛 **Bug修复**: 修复的问题
- 🎨 **界面改进**: UI/UX 改进
- ⚡ **性能优化**: 性能提升
- 🔧 **技术细节**: 技术实现细节
- 📝 **文档**: 文档更新
- 🔒 **安全**: 安全相关更新
- ⚠️ **已知问题**: 已知但未修复的问题
- 🗑️ **废弃**: 即将移除的功能

---

## 如何使用本文档

### 查看特定版本的更新
```bash
# 查看 v1.1.4 的更新内容
git show v1.1.4:CHANGELOG.md
```

### 比较两个版本的差异
```bash
# 比较 v1.1.3 和 v1.1.4 的差异
git diff v1.1.3..v1.1.4
```

### 切换到特定版本
```bash
# 切换到 v1.1.4
git checkout v1.1.4
```

---

**保持更新日志的完整性和准确性，有助于团队协作和问题追溯！** 📚

